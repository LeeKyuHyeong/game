# TODO
## 계정
- 관리자 : a@a.com / 123!@#
- 일반 : rbgud2380@naver.com / 1234

## 미완료 항목

### UI/UX 개선

### 기능 구현

### 관리자 화면
- [ ] 뱃지관리는 어디서?

╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Plan to implement                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                  │
│ 같은 설정으로 다시하기 기능 구현 계획                                                                                                                                                                                            │
│                                                                                                                                                                                                                                  │
│ 개요                                                                                                                                                                                                                             │
│                                                                                                                                                                                                                                  │
│ 맞추기 게임 결과 화면에서 "같은 설정으로 다시하기" 버튼을 추가하여, 이전 게임과 동일한 설정으로 바로 새 게임을 시작할 수 있게 합니다.                                                                                            │
│                                                                                                                                                                                                                                  │
│ - 기존 "다시 하기" 버튼은 유지 (설정 화면으로 이동)                                                                                                                                                                              │
│ - 새 버튼 추가: 이전 세션의 설정을 그대로 재사용하여 즉시 게임 시작                                                                                                                                                              │
│                                                                                                                                                                                                                                  │
│ ---                                                                                                                                                                                                                              │
│ 대상 게임 (4개)                                                                                                                                                                                                                  │
│ ┌─────────────────┬─────────────────────────────┬─────────────────────────────┐                                                                                                                                                  │
│ │      게임       │         결과 템플릿         │         버튼 텍스트         │                                                                                                                                                  │
│ ├─────────────────┼─────────────────────────────┼─────────────────────────────┤                                                                                                                                                  │
│ │ 일반 맞추기     │ guess/result.html           │ "같은 설정으로 다시하기"    │                                                                                                                                                  │
│ ├─────────────────┼─────────────────────────────┼─────────────────────────────┤                                                                                                                                                  │
│ │ 아티스트 챌린지 │ fan-challenge/result.html   │ "같은 아티스트로 다시 도전" │                                                                                                                                                  │
│ ├─────────────────┼─────────────────────────────┼─────────────────────────────┤                                                                                                                                                  │
│ │ 장르 챌린지     │ genre-challenge/result.html │ "같은 장르로 다시 도전"     │                                                                                                                                                  │
│ ├─────────────────┼─────────────────────────────┼─────────────────────────────┤                                                                                                                                                  │
│ │ 레트로 게임     │ retro/result.html           │ "같은 설정으로 다시하기"    │                                                                                                                                                  │
│ └─────────────────┴─────────────────────────────┴─────────────────────────────┘                                                                                                                                                  │
│ ---                                                                                                                                                                                                                              │
│ 수정 파일 목록                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                  │
│ 컨트롤러 (4개)                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                  │
│ 1. src/main/java/com/kh/game/controller/client/GameGuessController.java                                                                                                                                                          │
│ 2. src/main/java/com/kh/game/controller/client/GameFanChallengeController.java                                                                                                                                                   │
│ 3. src/main/java/com/kh/game/controller/client/GameGenreChallengeController.java                                                                                                                                                 │
│ 4. src/main/java/com/kh/game/controller/client/RetroGameController.java                                                                                                                                                          │
│                                                                                                                                                                                                                                  │
│ 템플릿 (4개)                                                                                                                                                                                                                     │
│                                                                                                                                                                                                                                  │
│ 1. src/main/resources/templates/client/game/guess/result.html                                                                                                                                                                    │
│ 2. src/main/resources/templates/client/game/fan-challenge/result.html                                                                                                                                                            │
│ 3. src/main/resources/templates/client/game/genre-challenge/result.html                                                                                                                                                          │
│ 4. src/main/resources/templates/client/game/retro/result.html                                                                                                                                                                    │
│                                                                                                                                                                                                                                  │
│ JavaScript (4개 - 기존 파일에 함수 추가)                                                                                                                                                                                         │
│                                                                                                                                                                                                                                  │
│ 1. src/main/resources/static/js/client/game-guess-result.js                                                                                                                                                                      │
│ 2. src/main/resources/static/js/client/game-fan-challenge-result.js                                                                                                                                                              │
│ 3. src/main/resources/static/js/client/game-genre-challenge-result.js                                                                                                                                                            │
│ 4. src/main/resources/static/js/client/game-retro-result.js                                                                                                                                                                      │
│                                                                                                                                                                                                                                  │
│ ---                                                                                                                                                                                                                              │
│ 구현 상세                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                  │
│ 1. 컨트롤러 - restart 엔드포인트 추가                                                                                                                                                                                            │
│                                                                                                                                                                                                                                  │
│ 각 컨트롤러에 POST /restart 엔드포인트 추가:                                                                                                                                                                                     │
│                                                                                                                                                                                                                                  │
│ @PostMapping("/restart")                                                                                                                                                                                                         │
│ @ResponseBody                                                                                                                                                                                                                    │
│ public ResponseEntity<Map<String, Object>> restartGame(                                                                                                                                                                          │
│         @RequestBody Map<String, Object> request,                                                                                                                                                                                │
│         HttpSession httpSession) {                                                                                                                                                                                               │
│                                                                                                                                                                                                                                  │
│     Long previousSessionId = ((Number) request.get("previousSessionId")).longValue();                                                                                                                                            │
│                                                                                                                                                                                                                                  │
│     // 1. 이전 세션 조회                                                                                                                                                                                                         │
│     GameSession previous = gameSessionService.findById(previousSessionId).orElse(null);                                                                                                                                          │
│     if (previous == null) {                                                                                                                                                                                                      │
│         return error("이전 게임 정보를 찾을 수 없습니다.");                                                                                                                                                                      │
│     }                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                  │
│     // 2. 이전 설정 추출 (gameMode, settings JSON, totalRounds 등)                                                                                                                                                               │
│     // 3. 새 게임 세션 생성 (기존 startGame 로직 재사용)                                                                                                                                                                         │
│     // 4. HTTP 세션에 새 세션 정보 저장                                                                                                                                                                                          │
│     // 5. 성공 응답 반환                                                                                                                                                                                                         │
│ }                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                  │
│ 2. 템플릿 - 버튼 및 데이터 추가                                                                                                                                                                                                  │
│                                                                                                                                                                                                                                  │
│ footer에 버튼과 데이터 속성 추가:                                                                                                                                                                                                │
│                                                                                                                                                                                                                                  │
│ <footer class="result-footer">                                                                                                                                                                                                   │
│     <!-- 재시작용 데이터 (CLAUDE.md 보안 규칙: th:data-* 사용) -->                                                                                                                                                               │
│     <span id="restartData"                                                                                                                                                                                                       │
│           th:data-session-id="${gameSession.id}"                                                                                                                                                                                 │
│           style="display:none;"></span>                                                                                                                                                                                          │
│                                                                                                                                                                                                                                  │
│     <!-- 새 버튼 -->                                                                                                                                                                                                             │
│     <button type="button" class="btn btn-restart" onclick="restartWithSameSettings()">                                                                                                                                           │
│         같은 설정으로 다시하기                                                                                                                                                                                                   │
│     </button>                                                                                                                                                                                                                    │
│                                                                                                                                                                                                                                  │
│     <!-- 기존 버튼 유지 -->                                                                                                                                                                                                      │
│     <a href="/game/solo/guess" class="btn btn-replay">다시 하기</a>                                                                                                                                                              │
│     ...                                                                                                                                                                                                                          │
│ </footer>                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                  │
│ 3. JavaScript - restart 함수 추가                                                                                                                                                                                                │
│                                                                                                                                                                                                                                  │
│ async function restartWithSameSettings() {                                                                                                                                                                                       │
│     const sessionId = document.getElementById('restartData').dataset.sessionId;                                                                                                                                                  │
│                                                                                                                                                                                                                                  │
│     try {                                                                                                                                                                                                                        │
│         const response = await fetch('/game/solo/guess/restart', {                                                                                                                                                               │
│             method: 'POST',                                                                                                                                                                                                      │
│             headers: { 'Content-Type': 'application/json' },                                                                                                                                                                     │
│             body: JSON.stringify({ previousSessionId: sessionId })                                                                                                                                                               │
│         });                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                  │
│         const result = await response.json();                                                                                                                                                                                    │
│                                                                                                                                                                                                                                  │
│         if (result.success) {                                                                                                                                                                                                    │
│             window.location.href = '/game/solo/guess/play';                                                                                                                                                                      │
│         } else {                                                                                                                                                                                                                 │
│             alert(result.message || '재시작에 실패했습니다.');                                                                                                                                                                   │
│             if (result.redirectUrl) {                                                                                                                                                                                            │
│                 window.location.href = result.redirectUrl;                                                                                                                                                                       │
│             }                                                                                                                                                                                                                    │
│         }                                                                                                                                                                                                                        │
│     } catch (error) {                                                                                                                                                                                                            │
│         console.error('Restart error:', error);                                                                                                                                                                                  │
│         alert('재시작 중 오류가 발생했습니다.');                                                                                                                                                                                 │
│     }                                                                                                                                                                                                                            │
│ }                                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                  │
│ ---                                                                                                                                                                                                                              │
│ 게임별 세부 구현                                                                                                                                                                                                                 │
│                                                                                                                                                                                                                                  │
│ 1. 일반 맞추기 (GameGuessController)                                                                                                                                                                                             │
│                                                                                                                                                                                                                                  │
│ 재사용할 설정:                                                                                                                                                                                                                   │
│ - gameMode (RANDOM, FIXED_GENRE, FIXED_ARTIST, FIXED_YEAR, *_PER_ROUND)                                                                                                                                                          │
│ - totalRounds                                                                                                                                                                                                                    │
│ - settings JSON (timeLimit, selectedYears, selectedArtists, soloOnly, groupOnly, fixedGenreId 등)                                                                                                                                │
│ - nickname                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                  │
│ 특별 처리:                                                                                                                                                                                                                       │
│ - *_PER_ROUND 모드: 버튼 숨김 처리 (매 라운드 선택이라 "같은 설정" 의미 없음)                                                                                                                                                    │
│ <button th:unless="${gameSession.gameMode.name().contains('PER_ROUND')}" ...>                                                                                                                                                    │
│                                                                                                                                                                                                                                  │
│ 2. 아티스트 챌린지 (GameFanChallengeController)                                                                                                                                                                                  │
│                                                                                                                                                                                                                                  │
│ 재사용할 설정:                                                                                                                                                                                                                   │
│ - challengeArtist (GameSession 필드)                                                                                                                                                                                             │
│ - difficulty (settings JSON에서 추출)                                                                                                                                                                                            │
│ - stageLevel (settings JSON에서 추출)                                                                                                                                                                                            │
│ - nickname                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                  │
│ 3. 장르 챌린지 (GameGenreChallengeController)                                                                                                                                                                                    │
│                                                                                                                                                                                                                                  │
│ 재사용할 설정:                                                                                                                                                                                                                   │
│ - challengeGenreCode (GameSession 필드)                                                                                                                                                                                          │
│ - difficulty (settings JSON에서 추출)                                                                                                                                                                                            │
│ - nickname                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                  │
│ 4. 레트로 게임 (RetroGameController)                                                                                                                                                                                             │
│                                                                                                                                                                                                                                  │
│ 재사용할 설정:                                                                                                                                                                                                                   │
│ - totalRounds                                                                                                                                                                                                                    │
│ - settings JSON (soloOnly, groupOnly, timeLimit)                                                                                                                                                                                 │
│ - nickname                                                                                                                                                                                                                       │
│                                                                                                                                                                                                                                  │
│ ---                                                                                                                                                                                                                              │
│ 예외 처리                                                                                                                                                                                                                        │
│ ┌─────────────────────┬───────────────────────────────────────────┐                                                                                                                                                              │
│ │        상황         │                   처리                    │                                                                                                                                                              │
│ ├─────────────────────┼───────────────────────────────────────────┤                                                                                                                                                              │
│ │ 이전 세션 없음      │ 에러 메시지 + 설정 화면으로 리다이렉트    │                                                                                                                                                              │
│ ├─────────────────────┼───────────────────────────────────────────┤                                                                                                                                                              │
│ │ 설정 JSON 파싱 실패 │ 기본값 사용 또는 설정 화면으로 리다이렉트 │                                                                                                                                                              │
│ ├─────────────────────┼───────────────────────────────────────────┤                                                                                                                                                              │
│ │ 곡 수 부족 (챌린지) │ 에러 메시지 + 설정 화면으로 리다이렉트    │                                                                                                                                                              │
│ └─────────────────────┴───────────────────────────────────────────┘                                                                                                                                                              │
│ ---                                                                                                                                                                                                                              │
│ 구현 순서                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                  │
│ 1. 레트로 게임 (가장 단순 - 설정이 적음)                                                                                                                                                                                         │
│ 2. 일반 맞추기 (PER_ROUND 모드 처리 필요)                                                                                                                                                                                        │
│ 3. 아티스트 챌린지                                                                                                                                                                                                               │
│ 4. 장르 챌린지                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                  │
│ ---                                                                                                                                                                                                                              │
│ 검증 방법                                                                                                                                                                                                                        │
│                                                                                                                                                                                                                                  │
│ 1. 각 게임 유형별로:                                                                                                                                                                                                             │
│   - 설정 화면에서 다양한 옵션 선택 후 게임 진행                                                                                                                                                                                  │
│   - 결과 화면에서 "같은 설정으로 다시하기" 클릭                                                                                                                                                                                  │
│   - 새 게임이 동일한 설정으로 시작되는지 확인                                                                                                                                                                                    │
│   - 기존 "다시 하기" 버튼이 설정 화면으로 이동하는지 확인                                                                                                                                                                        │
│ 2. 예외 케이스:                                                                                                                                                                                                                  │
│   - 브라우저 새로고침 후 재시작 시도 → 에러 처리 확인                                                                                                                                                                            │
│   - PER_ROUND 모드에서 버튼 숨김 확인 (일반 맞추기)
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
                                                                                    