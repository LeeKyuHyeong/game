<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common/fragments/head :: clientHead('ì»¤ë®¤ë‹ˆí‹° - Song Quiz')}"></head>
<body class="client-page board-page">
<div class="client-container">
    <header class="client-header compact">
        <nav class="header-nav">
            <a href="/" class="btn-home">ğŸ  í™ˆ</a>
        </nav>
        <h1>ğŸ’¬ ì»¤ë®¤ë‹ˆí‹°</h1>
        <p>ê³¡ ì¶”ì²œ, ì˜ê²¬, ììœ ë¡œìš´ ì´ì•¼ê¸°</p>
    </header>

    <main class="client-main">
        <div class="board-content">
            <!-- Category Tabs (PC) -->
            <div class="category-tabs">
                <a th:href="@{/board}" th:classappend="${category == null} ? 'active'" class="category-tab">
                    ì „ì²´
                    <span class="category-count" th:text="'(' + ${totalItems} + ')'"></span>
                </a>
                <th:block th:each="cat : ${categories}">
                    <a th:href="@{/board(category=${cat.name()})}"
                       th:classappend="${category == cat.name()} ? 'active'"
                       class="category-tab">
                        <span th:text="${cat.description}"></span>
                        <span class="category-count" th:text="'(' + ${categoryStats[cat.name()]} + ')'"></span>
                    </a>
                </th:block>
            </div>

            <!-- Category Select (Mobile) -->
            <div class="category-select-wrapper">
                <select class="category-select" id="categorySelect" onchange="navigateCategory(this)">
                    <option value="" th:selected="${category == null}">
                        ì „ì²´ (<span th:text="${totalItems}"></span>)
                    </option>
                    <th:block th:each="cat : ${categories}">
                        <option th:value="${cat.name()}" th:selected="${category == cat.name()}"
                                th:text="${cat.description} + ' (' + ${categoryStats[cat.name()]} + ')'">
                        </option>
                    </th:block>
                </select>
            </div>

            <!-- Search -->
            <form class="board-search" th:action="@{/board}" method="get">
                <input type="hidden" name="category" th:value="${category}" th:if="${category != null}">
                <input type="text" name="keyword" th:value="${keyword}" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                <button type="submit">ê²€ìƒ‰</button>
            </form>

            <!-- Board List -->
            <div class="board-table" th:if="${!#lists.isEmpty(boards)}">
                <th:block th:each="board : ${boards}">
                    <a th:href="@{/board/{id}(id=${board.id})}" class="board-row">
                        <span class="board-category-badge" th:classappend="${board.category.name()}"
                              th:text="${board.category.description}"></span>
                        <div class="board-info">
                            <div class="board-title" th:text="${board.title}"></div>
                            <div class="board-meta">
                                <span>
                                    <span th:if="${board.member.selectedBadgeEmoji}" class="member-badge" th:text="${board.member.selectedBadgeEmoji}" th:title="${board.member.selectedBadgeName}"></span>
                                    <span th:text="${board.member.nickname}"></span>
                                </span>
                                <span th:text="${#temporals.format(board.createdAt, 'MM.dd HH:mm')}"></span>
                            </div>
                        </div>
                        <div class="board-stats">
                            <span class="board-stat">ğŸ‘ <span th:text="${board.viewCount}">0</span></span>
                            <span class="board-stat">â¤ï¸ <span th:text="${board.likeCount}">0</span></span>
                            <span class="board-stat">ğŸ’¬ <span th:text="${board.commentCount}">0</span></span>
                        </div>
                    </a>
                </th:block>
            </div>

            <!-- Empty State -->
            <div class="board-empty" th:if="${#lists.isEmpty(boards)}">
                <div class="board-empty-icon">ğŸ“</div>
                <p th:if="${keyword != null}">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                <p th:if="${keyword == null}">ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì²« ë²ˆì§¸ ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
            </div>

            <!-- Pagination -->
            <div class="pagination" th:if="${totalPages > 1}">
                <a th:href="@{/board(page=${currentPage - 1}, category=${category}, keyword=${keyword})}"
                   th:classappend="${currentPage == 0} ? 'disabled'" class="page-btn">ì´ì „</a>
                <th:block th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                    <a th:if="${i >= currentPage - 2 and i <= currentPage + 2}"
                       th:href="@{/board(page=${i}, category=${category}, keyword=${keyword})}"
                       th:classappend="${i == currentPage} ? 'active'"
                       th:text="${i + 1}" class="page-btn"></a>
                </th:block>
                <a th:href="@{/board(page=${currentPage + 1}, category=${category}, keyword=${keyword})}"
                   th:classappend="${currentPage >= totalPages - 1} ? 'disabled'" class="page-btn">ë‹¤ìŒ</a>
            </div>

            <!-- Write Button -->
            <div class="board-actions">
                <a th:href="@{/board/write}" class="btn-write" th:if="${member != null}">âœï¸ ê¸€ì“°ê¸°</a>
                <a th:href="@{/auth/login(redirect='/board/write')}" class="btn-write" th:if="${member == null}">âœï¸ ë¡œê·¸ì¸ í›„ ê¸€ì“°ê¸°</a>
            </div>
        </div>
    </main>
</div>
<script th:src="@{/js/common/common.js}"></script>
<script>
function navigateCategory(select) {
    const category = select.value;
    if (category) {
        window.location.href = '/board?category=' + category;
    } else {
        window.location.href = '/board';
    }
}
</script>
</body>
</html>
