<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common/fragments/head :: clientHead('ê²Œì„ ê²°ê³¼ - Song Quiz')}"></head>
<body class="client-page result-page">
<div class="result-container">
    <header class="result-header">
        <h1>ğŸ† ê²Œì„ ê²°ê³¼</h1>
        <p th:text="${nickname}"></p>
    </header>

    <main class="result-main">
        <!-- ì ìˆ˜ ì„¹ì…˜ -->
        <div class="score-section">
            <div class="final-score">
                <span class="score-label">ìµœì¢… ì ìˆ˜</span>
                <span class="score-value" th:text="${gameSession.totalScore}">0</span>
            </div>
        </div>

        <!-- í†µê³„ ë°” - í•œ ì¤„ -->
        <div class="stats-bar">
            <div class="stat-item">
                <span class="stat-label">ì •ë‹µ</span>
                <span class="stat-value correct" th:text="${gameSession.correctCount}">0</span>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
                <span class="stat-label">ì˜¤ë‹µ</span>
                <span class="stat-value wrong" th:text="${gameSession.completedRounds - gameSession.correctCount - gameSession.skipCount}">0</span>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
                <span class="stat-label">ìŠ¤í‚µ</span>
                <span class="stat-value skip" th:text="${gameSession.skipCount}">0</span>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
                <span class="stat-label">ì •ë‹µë¥ </span>
                <span class="stat-value" th:text="${#numbers.formatDecimal(gameSession.accuracyRate, 1, 1) + '%'}">0%</span>
            </div>
        </div>

        <!-- ë¼ìš´ë“œ ê¸°ë¡ - ì¹´ë“œ ê·¸ë¦¬ë“œ -->
        <div class="rounds-section">
            <h3>ë¼ìš´ë“œ ê¸°ë¡</h3>
            <div class="rounds-grid">
                <div th:each="round : ${rounds}" class="round-card"
                     th:classappend="${round.isCorrect ? 'correct' : (round.status.name() == 'SKIPPED' ? 'skipped' : 'wrong')}">
                    <div class="round-header">
                        <span class="round-num" th:text="'#' + ${round.roundNumber}"></span>
                        <span th:if="${round.isCorrect}" class="round-status correct">ì •ë‹µ</span>
                        <span th:if="${round.status.name() == 'SKIPPED'}" class="round-status skip">ìŠ¤í‚µ</span>
                        <span th:if="${!round.isCorrect && round.status.name() != 'SKIPPED'}" class="round-status wrong">ì˜¤ë‹µ</span>
                    </div>
                    <div class="round-body">
                        <div class="song-info">
                            <div class="song-title" th:text="${round.song.title}"></div>
                            <div class="song-artist" th:text="${round.song.artist}"></div>
                        </div>
                        <div th:if="${round.isCorrect}" class="score-info">
                            <span class="score-plus" th:text="'+' + ${round.score} + 'ì '"></span>
                            <span th:if="${round.answerTimeMs != null}" class="attempt-info" th:text="'(' + ${#numbers.formatDecimal(round.answerTimeMs / 1000.0, 1, 1)} + 'ì´ˆ)'"></span>
                        </div>
                        <div th:if="${!round.isCorrect && round.status.name() != 'SKIPPED'}" class="fail-info">
                            <span class="fail-text">3íšŒ ì‹¤íŒ¨</span>
                        </div>
                        <!-- ì‹œë„ ë‚´ì—­ í‘œì‹œ (ì˜¤ë‹µ/ì •ë‹µ ëª¨ë‘) -->
                        <div th:if="${round.attempts != null && !round.attempts.isEmpty()}" class="attempts-section">
                            <div class="attempts-label">ë‚´ ë‹µë³€:</div>
                            <div class="attempts-list">
                                <div th:each="attempt : ${round.attempts}" class="attempt-item"
                                     th:classappend="${attempt.isCorrect} ? 'correct' : 'wrong'">
                                    <span class="attempt-num" th:text="${attempt.attemptNumber} + 'ì°¨'"></span>
                                    <span class="attempt-answer" th:text="${attempt.userAnswer}"></span>
                                    <span th:if="${attempt.isCorrect}" class="attempt-result correct">O</span>
                                    <span th:if="${!attempt.isCorrect}" class="attempt-result wrong">X</span>
                                </div>
                            </div>
                        </div>
                        <button class="btn-report-small" th:data-song-id="${round.song.id}" onclick="openReportModal(this.dataset.songId)">ì‹ ê³ </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="result-footer">
        <a href="/game/solo/guess" class="btn btn-replay">ë‹¤ì‹œ í•˜ê¸° ğŸ”„</a>
        <a href="/" class="btn btn-home">í™ˆìœ¼ë¡œ ğŸ </a>
    </footer>
</div>

<script th:src="@{/js/common/common.js}"></script>

<!-- ì‹ ê³  ëª¨ë‹¬ -->
<th:block th:replace="~{common/fragments/report-modal :: reportModal}"></th:block>

<style>
.btn-report-small {
    display: block;
    margin-top: 8px;
    padding: 4px 10px;
    font-size: 0.75em;
    background: #f8f9fa;
    color: #888;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
}
.btn-report-small:hover {
    background: #fff;
    color: #dc3545;
    border-color: #dc3545;
}

/* ì‹œë„ ë‚´ì—­ ìŠ¤íƒ€ì¼ */
.attempts-section {
    margin-top: 12px;
    padding-top: 10px;
    border-top: 1px dashed #e0e0e0;
}
.attempts-label {
    font-size: 0.75em;
    color: #666;
    margin-bottom: 6px;
    font-weight: 500;
}
.attempts-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
}
.attempt-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8em;
    background: #f8f9fa;
}
.attempt-item.correct {
    background: #e8f5e9;
}
.attempt-item.wrong {
    background: #ffebee;
}
.attempt-num {
    font-weight: 600;
    color: #666;
    min-width: 28px;
}
.attempt-answer {
    flex: 1;
    color: #333;
    word-break: break-all;
}
.attempt-result {
    font-weight: 700;
    min-width: 20px;
    text-align: center;
}
.attempt-result.correct {
    color: #4caf50;
}
.attempt-result.wrong {
    color: #f44336;
}
</style>
</body>
</html>