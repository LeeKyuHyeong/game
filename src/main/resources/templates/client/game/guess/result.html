<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common/fragments/head :: clientHead('게임 결과 - Song Quiz')}"></head>
<body class="client-page result-page">
<div class="result-container">
    <header class="result-header">
        <h1>🏆 게임 결과</h1>
        <p th:text="${nickname}"></p>
    </header>

    <main class="result-main">
        <!-- 점수 섹션 -->
        <div class="score-section">
            <div class="final-score">
                <span class="score-label">최종 점수</span>
                <span class="score-value" th:text="${gameSession.totalScore}">0</span>
            </div>
        </div>

        <!-- 통계 섹션 -->
        <div class="stats-section">
            <div class="stat-box">
                <div class="stat-label">정답</div>
                <div class="stat-value correct" th:text="${gameSession.correctCount}">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">오답</div>
                <div class="stat-value wrong" th:text="${gameSession.completedRounds - gameSession.correctCount - gameSession.skipCount}">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">스킵</div>
                <div class="stat-value skip" th:text="${gameSession.skipCount}">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">정답률</div>
                <div class="stat-value" th:text="${#numbers.formatDecimal(gameSession.accuracyRate, 1, 1) + '%'}">0%</div>
            </div>
        </div>

        <!-- 라운드 기록 섹션 -->
        <div class="rounds-section">
            <h3>📝 라운드 기록</h3>
            <div class="rounds-list">
                <div th:each="round : ${rounds}"
                     class="round-item"
                     th:classappend="${round.isCorrect ? 'correct' : (round.status.name() == 'SKIPPED' ? 'skipped' : 'wrong')}">
                    <span class="round-number" th:text="'#' + ${round.roundNumber}"></span>
                    <div class="round-song">
                        <span class="song-title" th:text="${round.song.title}"></span>
                        <span class="song-artist" th:text="${round.song.artist}"></span>
                    </div>
                    <div class="round-result">
                        <span th:if="${round.isCorrect}" class="result-badge correct">
                            정답! +<span th:text="${round.score}"></span>점
                        </span>
                        <span th:if="${round.isCorrect}"
                              class="round-attempt-info"
                              th:classappend="'attempt-' + ${round.attemptCount}"
                              th:text="'(' + ${round.attemptCount} + '번째 시도)'"></span>
                        <span th:if="${round.status.name() == 'SKIPPED'}" class="result-badge skip">스킵</span>
                        <span th:if="${!round.isCorrect && round.status.name() != 'SKIPPED'}" class="result-badge wrong">
                            오답 (3회 실패)
                        </span>
                    </div>
                    <div class="round-attempts" th:if="${round.attempts != null && !round.attempts.isEmpty()}">
                        <small>시도 기록: </small>
                        <span th:each="attempt, stat : ${round.attempts}" class="attempt-item">
                            <span th:classappend="${attempt.isCorrect ? 'correct' : 'wrong'}"
                                  th:text="${attempt.userAnswer}"></span>
                            <span th:if="${!stat.last}">, </span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="result-footer">
        <a href="/game/solo/guess" class="btn btn-replay">다시 하기 🔄</a>
        <a href="/" class="btn btn-home">홈으로 🏠</a>
    </footer>
</div>

<script th:src="@{/js/common/common.js}"></script>
</body>
</html>