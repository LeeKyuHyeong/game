<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common/fragments/head :: clientHead('내가 맞추기 - Song Quiz')}"></head>
<body class="client-page">
<div class="client-container">
    <header class="client-header compact">
        <nav class="header-nav">
            <a href="/" class="btn-home">🏠 홈</a>
        </nav>
        <h1>🎧 내가 맞추기</h1>
        <p>노래를 듣고 제목을 맞춰보세요!</p>
    </header>

    <main class="setup-main">
        <div class="setup-card">
            <!-- 30개 챌린지 바로가기 -->
            <div class="challenge-shortcut" id="challengeShortcut">
                <div class="challenge-shortcut-content" th:if="${isLoggedIn}">
                    <div class="challenge-icon">🎯</div>
                    <div class="challenge-info">
                        <strong>30개 챌린지</strong>
                        <span>전체 랜덤 30곡, 랭킹 도전!</span>
                    </div>
                    <button type="button" class="btn-challenge" onclick="openChallengeModal()">바로 시작</button>
                </div>
                <div class="challenge-shortcut-content locked" th:if="${!isLoggedIn}">
                    <div class="challenge-icon">🔒</div>
                    <div class="challenge-info">
                        <strong>30개 챌린지</strong>
                        <span>로그인 후 랭킹에 도전하세요!</span>
                    </div>
                    <a th:href="@{/auth/login}" class="btn-challenge-login">로그인</a>
                </div>
            </div>

            <div class="setup-divider">
                <span>또는 직접 설정</span>
            </div>

            <div class="setup-step" id="step1">
                <h2>게임 설정</h2>

                <div class="form-group">
                    <label>닉네임</label>
                    <input type="text" id="nickname" placeholder="별명을 입력하세요" maxlength="20" class="nickname-input">
                </div>

                <div class="form-group" id="roundSettingArea">
                    <label>진행 라운드 <span id="songCountInfo" class="song-count-info"></span></label>
                    <div class="round-input-group">
                        <button type="button" class="round-adjust-btn" onclick="adjustRounds(-1)">−</button>
                        <input type="number" id="totalRounds" value="10" min="1" max="50" class="round-input">
                        <button type="button" class="round-adjust-btn" onclick="adjustRounds(1)">+</button>
                    </div>
                    <div class="round-presets">
                        <button type="button" class="preset-btn" onclick="setRounds(5)">5</button>
                        <button type="button" class="preset-btn active" onclick="setRounds(10)">10</button>
                        <button type="button" class="preset-btn" onclick="setRounds(15)">15</button>
                        <button type="button" class="preset-btn" onclick="setRounds(20)">20</button>
                    </div>
                    <!-- 모바일: 아티스트 유형 (프리셋 자리에 표시) -->
                    <div class="mobile-artist-type">
                        <label>아티스트</label>
                        <select id="artistTypeSelectMobile" class="mode-select" onchange="syncArtistTypeFromMobileSelect()">
                            <option value="all">전체</option>
                            <option value="solo">솔로</option>
                            <option value="group">그룹</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>게임 모드</label>
                    <div class="mode-options">
                        <!-- 고정 모드 -->
                        <div class="mode-group">
                            <div class="mode-group-label">고정 모드</div>
                            <label class="mode-option">
                                <input type="radio" name="gameMode" value="RANDOM" checked>
                                <span class="mode-label">
                                    <strong>전체 랜덤</strong>
                                    <small>모든 노래 중 랜덤 출제</small>
                                </span>
                            </label>
                            <label class="mode-option">
                                <input type="radio" name="gameMode" value="FIXED_GENRE">
                                <span class="mode-label">
                                    <strong>장르 고정</strong>
                                    <small>선택한 장르에서만 출제</small>
                                </span>
                            </label>
                            <label class="mode-option">
                                <input type="radio" name="gameMode" value="FIXED_ARTIST">
                                <span class="mode-label">
                                    <strong>아티스트 고정</strong>
                                    <small>선택한 아티스트 노래만 출제</small>
                                </span>
                            </label>
                            <label class="mode-option">
                                <input type="radio" name="gameMode" value="FIXED_YEAR">
                                <span class="mode-label">
                                    <strong>연도 고정</strong>
                                    <small>선택한 연도 노래만 출제</small>
                                </span>
                            </label>
                        </div>

                        <!-- 매 라운드 선택 모드 -->
                        <div class="mode-group">
                            <div class="mode-group-label">매 라운드 선택</div>
                            <label class="mode-option">
                                <input type="radio" name="gameMode" value="GENRE_PER_ROUND">
                                <span class="mode-label">
                                    <strong>장르 선택</strong>
                                    <small>매 라운드마다 장르 선택</small>
                                </span>
                            </label>
                            <label class="mode-option">
                                <input type="radio" name="gameMode" value="ARTIST_PER_ROUND">
                                <span class="mode-label">
                                    <strong>아티스트 선택</strong>
                                    <small>매 라운드마다 아티스트 선택</small>
                                </span>
                            </label>
                            <label class="mode-option">
                                <input type="radio" name="gameMode" value="YEAR_PER_ROUND">
                                <span class="mode-label">
                                    <strong>연도 선택</strong>
                                    <small>매 라운드마다 연도 선택</small>
                                </span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- 장르 선택 (FIXED_GENRE) -->
                <div class="form-group mode-selection-area" id="genreSelectArea" style="display:none;">
                    <label>장르 선택</label>
                    <select id="fixedGenreId" class="mode-select">
                        <option value="">선택하세요</option>
                        <option th:each="genre : ${genres}" th:value="${genre.id}" th:text="${genre.name}"></option>
                    </select>
                </div>

                <!-- 아티스트 선택 (FIXED_ARTIST) -->
                <div class="form-group mode-selection-area" id="artistSelectArea" style="display:none;">
                    <label>아티스트 선택 <span id="artistSelectCountInfo" class="filter-count-info"></span></label>
                    <input type="text" id="artistSearchInput" placeholder="아티스트명 검색..." class="filter-search-input" autocomplete="off">
                    <div class="multi-select-chips" id="artistSelectChips">
                        <div class="chips-loading">로딩 중...</div>
                    </div>
                </div>

                <!-- 연도 선택 (FIXED_YEAR) -->
                <div class="form-group mode-selection-area" id="yearSelectArea" style="display:none;">
                    <label>연도 선택 <span id="yearSelectCountInfo" class="filter-count-info"></span></label>
                    <div class="multi-select-chips" id="yearSelectChips">
                        <div class="chips-loading">로딩 중...</div>
                    </div>
                </div>

                <!-- 매 라운드 옵션 -->
                <div class="form-group mode-selection-area" id="perRoundOptions" style="display:none;">
                    <label>추가 옵션</label>
                    <div class="checkbox-option">
                        <label class="toggle-option">
                            <input type="checkbox" id="hideEmptyOptions">
                            <span class="toggle-label">선택 가능한 항목만 표시</span>
                        </label>
                    </div>
                </div>

                <!-- 아티스트 유형 (전체/솔로/그룹) - PC만 표시 -->
                <div class="form-group" id="artistTypeArea">
                    <label>아티스트 유형</label>
                    <div class="artist-type-options">
                        <label class="type-option">
                            <input type="radio" name="artistType" value="all" checked>
                            <span>전체</span>
                        </label>
                        <label class="type-option">
                            <input type="radio" name="artistType" value="solo">
                            <span>솔로만</span>
                        </label>
                        <label class="type-option">
                            <input type="radio" name="artistType" value="group">
                            <span>그룹만</span>
                        </label>
                    </div>
                </div>

                <div class="step-buttons">
                    <button type="button" class="btn btn-start" onclick="startGame()">게임 시작!</button>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- 30개 챌린지 모달 -->
<div class="modal" id="challengeModal">
    <div class="modal-content challenge-modal">
        <div class="challenge-modal-header">
            <span class="challenge-modal-icon">🏆</span>
            <h2>30개 챌린지</h2>
        </div>
        <div class="challenge-modal-body">
            <div class="challenge-rules">
                <h3>📋 규칙</h3>
                <ul>
                    <li><span class="rule-icon">🎲</span> 전체 장르에서 <strong>랜덤 30곡</strong> 출제</li>
                    <li><span class="rule-icon">🎯</span> 곡당 <strong>3번의 기회</strong>로 정답 맞추기</li>
                    <li><span class="rule-icon">⏱️</span> 제한 시간 없이 차분하게 도전</li>
                    <li><span class="rule-icon">🏆</span> <strong>최고 점수</strong>가 랭킹에 기록됩니다</li>
                </ul>
            </div>
            <div class="challenge-scoring">
                <h3>💯 점수</h3>
                <div class="scoring-table">
                    <div class="score-row"><span>5초 이내 정답</span><strong>100점</strong></div>
                    <div class="score-row"><span>8초 이내 정답</span><strong>90점</strong></div>
                    <div class="score-row"><span>12초 이내 정답</span><strong>80점</strong></div>
                    <div class="score-row"><span>15초 이내 정답</span><strong>70점</strong></div>
                    <div class="score-row"><span>15초 초과 정답</span><strong>60점</strong></div>
                    <div class="score-row total"><span>만점</span><strong>3000점</strong></div>
                </div>
            </div>
        </div>
        <div class="challenge-modal-footer">
            <button type="button" class="btn-cancel" onclick="closeChallengeModal()">취소</button>
            <button type="button" class="btn-start-challenge" onclick="startChallenge()">🎮 챌린지 시작!</button>
        </div>
    </div>
</div>

<script th:inline="javascript">
    const isLoggedIn = [[${isLoggedIn}]];
    const memberNickname = [[${memberNickname}]];
</script>
<script th:src="@{/js/common/common.js}"></script>
<script th:src="@{/js/client/game-guess-setup.js}"></script>
</body>
</html>
