<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common/fragments/head :: clientHead('Ïû•Î•¥ Ï±åÎ¶∞ÏßÄ - Song Quiz')}"></head>
<link rel="stylesheet" th:href="@{/css/client/game-common.css}">
<link rel="stylesheet" th:href="@{/css/client/game-genre-challenge.css}">
<body class="client-page game-page">
<div class="game-container genre-challenge">
    <header class="game-header">
        <div class="header-left">
            <span class="genre-name" th:text="${genreName}">Ïû•Î•¥</span>
            <span class="round-info">
                <span id="currentRound">1</span> / <span id="totalRounds">?</span>
            </span>
        </div>
        <div class="header-center">
            <div id="livesContainer" class="lives-container">
                <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê® -->
            </div>
            <div id="comboContainer" class="combo-container">
                <span class="combo-label">COMBO</span>
                <span id="comboCount" class="combo-count">0</span>
            </div>
        </div>
        <div class="header-right">
            <span class="correct-count">
                <span id="correctCount">0</span>Í≥° Ï†ïÎãµ
            </span>
            <a href="/" class="btn-home"><span class="btn-icon">üè†</span> Ìôà</a>
            <button type="button" class="btn btn-quit" onclick="quitGame()">Ìè¨Í∏∞</button>
        </div>
    </header>

    <main class="game-main">
        <!-- Ï§ÄÎπÑ ÌôîÎ©¥ -->
        <div id="readyScreen" class="ready-screen">
            <div class="ready-content">
                <div class="ready-icon">&#127912;</div>
                <h2 th:text="${genreName + ' Ïû•Î•¥ Ï±åÎ¶∞ÏßÄ'}">Ïû•Î•¥ Ï±åÎ¶∞ÏßÄ</h2>
                <p>
                    <span th:text="${playTimeMs / 1000}">7</span>Ï¥à Îì£Í∏∞ +
                    <span th:text="${answerTimeMs / 1000}">6</span>Ï¥à ÏûÖÎ†• ÏãúÍ∞Ñ!
                </p>
                <div class="ready-difficulty">
                    <span class="difficulty-badge" th:data-difficulty="${difficulty}">
                        <span th:text="${difficultyEmoji != null ? difficultyEmoji : '‚≠ê'}"></span>
                        <span th:text="${difficultyName}">ÏùºÎ∞ò</span>
                    </span>
                    <span th:if="${!isRanked}" class="practice-label">Ïó∞Ïäµ Î™®Îìú</span>
                    <span th:if="${isRanked}" class="ranked-label">Í≥µÏãù Îû≠ÌÇπ</span>
                </div>
                <button type="button" class="btn btn-ready" onclick="startRound()">Ï§ÄÎπÑ ÏôÑÎ£å!</button>
            </div>
        </div>

        <!-- Í≤åÏûÑ ÌôîÎ©¥ -->
        <div id="gameScreen" class="game-screen" style="display: none;">
            <!-- ÌÉÄÏù¥Î®∏ -->
            <div class="timer-section">
                <div class="timer-bar-container">
                    <div id="timerBar" class="timer-bar"></div>
                </div>
                <div class="timer-text">
                    <span id="timerValue">10.0</span>Ï¥à
                </div>
                <div id="phaseText" class="phase-text playing">üéµ Îì£Îäî Ï§ë...</div>
            </div>

            <!-- ÏΩ§Î≥¥ ÌëúÏãú (ÌÅ∞ ÌôîÎ©¥) -->
            <div id="comboBig" class="combo-big" style="display: none;">
                <span class="combo-big-number">0</span>
                <span class="combo-big-label">COMBO!</span>
            </div>

            <!-- ÏùåÏïÖ ÌîåÎ†àÏù¥Ïñ¥ (Ïà®ÍπÄ) -->
            <div class="player-section">
                <div class="music-icon">&#127911;</div>
                <p class="now-playing">ÎÖ∏Îûò Ïû¨ÏÉù Ï§ë...</p>
            </div>

            <!-- Ï†ïÎãµ ÏûÖÎ†• -->
            <div class="answer-section">
                <input type="text" id="answerInput" class="answer-input"
                       placeholder="ÎÖ∏Îûò Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" autocomplete="off">
                <button type="button" id="submitBtn" class="btn btn-submit" onclick="submitAnswer()">
                    Ï†ïÎãµ!
                </button>
            </div>
        </div>

        <!-- Ï†ïÎãµ Í≥µÍ∞ú Î™®Îã¨ -->
        <div id="answerModal" class="modal" style="display: none;">
            <div class="modal-content answer-modal">
                <div id="answerResult" class="answer-result"></div>
                <div class="answer-info">
                    <p class="correct-answer-label">Ï†ïÎãµ</p>
                    <p id="correctAnswer" class="correct-answer"></p>
                </div>
                <div class="modal-stats">
                    <div class="stat-item">
                        <span class="stat-label">ÎÇ®ÏùÄ ÎùºÏù¥ÌîÑ</span>
                        <span id="modalLives" class="stat-value lives"></span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Ï†ïÎãµ</span>
                        <span id="modalCorrect" class="stat-value">0</span>
                    </div>
                    <div class="stat-item combo-stat">
                        <span class="stat-label">ÏΩ§Î≥¥</span>
                        <span id="modalCombo" class="stat-value combo">0</span>
                    </div>
                </div>
                <button type="button" id="nextBtn" class="btn btn-next" onclick="nextRound()">
                    Îã§Ïùå Í≥°
                </button>
            </div>
        </div>

        <!-- Í≤åÏûÑ Ïò§Î≤Ñ Î™®Îã¨ -->
        <div id="gameOverModal" class="modal" style="display: none;">
            <div class="modal-content gameover-modal">
                <div id="gameOverTitle" class="gameover-title"></div>
                <div id="gameOverMessage" class="gameover-message"></div>
                <button type="button" class="btn btn-result" onclick="goToResult()">
                    Í≤∞Í≥º Î≥¥Í∏∞
                </button>
            </div>
        </div>
    </main>

    <!-- Î™®Î∞îÏùº ÌîåÎ°úÌåÖ Î≤ÑÌäº (Î™®Î∞îÏùºÏóêÏÑúÎßå ÌëúÏãú) -->
    <div class="mobile-floating-buttons">
        <a href="/" class="floating-btn floating-home">Ìôà</a>
        <button type="button" class="floating-btn floating-quit" onclick="quitGame()">Ìè¨Í∏∞</button>
    </div>
</div>

<!-- YouTube Player (Ïà®ÍπÄ) -->
<div id="youtubePlayerContainer" style="position: absolute; left: -9999px;">
    <div id="youtubePlayer"></div>
</div>

<!-- Audio Player (MP3Ïö©) -->
<audio id="audioPlayer" style="display: none;"></audio>

<script th:inline="javascript">
    const sessionId = [[${sessionId}]];
    const genreCode = [[${genreCode}]];
    const genreName = [[${genreName}]];
    const difficulty = [[${difficulty}]];
    const initialPlayTimeMs = [[${playTimeMs}]];
    const initialAnswerTimeMs = [[${answerTimeMs}]];
    const initialLives = [[${initialLives}]];
</script>
<script src="https://www.youtube.com/iframe_api"></script>
<script th:src="@{/js/client/game-genre-challenge-play.js}"></script>
</body>
</html>
