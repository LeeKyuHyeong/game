<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common/fragments/head :: clientHead('ê²Œì„ ê²°ê³¼ - Song Quiz')}"></head>
<body class="client-page result-page">
<div class="result-container">
    <header class="result-header">
        <h1>ğŸ† ê²Œì„ ê²°ê³¼</h1>
    </header>

    <main class="result-main">
        <!-- ë°ìŠ¤í¬íƒ‘: í¬ë””ì›€ -->
        <div class="podium-section desktop-only" th:if="${#lists.size(playerScores) >= 1}">
            <div class="podium">
                <div class="podium-place second" th:if="${#lists.size(playerScores) >= 2}">
                    <div class="place-medal" th:text="${playerScores[1].rank == 1} ? 'ğŸ¥‡' : (${playerScores[1].rank == 2} ? 'ğŸ¥ˆ' : 'ğŸ¥‰')"></div>
                    <div class="place-name" th:text="${playerScores[1].name}"></div>
                    <div class="place-score" th:text="${playerScores[1].score} + 'ì '"></div>
                    <div class="place-stand" th:text="${playerScores[1].rank}"></div>
                </div>
                <div class="podium-place first">
                    <div class="place-medal" th:text="${playerScores[0].rank == 1} ? 'ğŸ¥‡' : (${playerScores[0].rank == 2} ? 'ğŸ¥ˆ' : 'ğŸ¥‰')"></div>
                    <div class="place-name" th:text="${playerScores[0].name}"></div>
                    <div class="place-score" th:text="${playerScores[0].score} + 'ì '"></div>
                    <div class="place-stand" th:text="${playerScores[0].rank}"></div>
                </div>
                <div class="podium-place third" th:if="${#lists.size(playerScores) >= 3}">
                    <div class="place-medal" th:text="${playerScores[2].rank == 1} ? 'ğŸ¥‡' : (${playerScores[2].rank == 2} ? 'ğŸ¥ˆ' : 'ğŸ¥‰')"></div>
                    <div class="place-name" th:text="${playerScores[2].name}"></div>
                    <div class="place-score" th:text="${playerScores[2].score} + 'ì '"></div>
                    <div class="place-stand" th:text="${playerScores[2].rank}"></div>
                </div>
            </div>
        </div>

        <!-- ëª¨ë°”ì¼: ë­í‚¹ ë¦¬ìŠ¤íŠ¸ -->
        <div class="ranking-list-section mobile-only" th:if="${#lists.size(playerScores) >= 1}">
            <div th:each="entry : ${playerScores}" class="ranking-row"
                 th:classappend="${entry.rank == 1} ? 'first' : (${entry.rank == 2} ? 'second' : (${entry.rank == 3} ? 'third' : ''))">
                <span class="rank-medal" th:text="${entry.rank == 1} ? 'ğŸ¥‡' : (${entry.rank == 2} ? 'ğŸ¥ˆ' : (${entry.rank == 3} ? 'ğŸ¥‰' : ${entry.rank}))"></span>
                <span class="rank-name" th:text="${entry.name}"></span>
                <span class="rank-score" th:text="${entry.score} + 'ì '"></span>
            </div>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <span class="stat-label">ì •ë‹µ</span>
                <span class="stat-value correct" th:text="${gameSession.correctCount}"></span>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
                <span class="stat-label">ìŠ¤í‚µ</span>
                <span class="stat-value skip" th:text="${gameSession.skipCount}"></span>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
                <span class="stat-label">ì •ë‹µë¥ </span>
                <span class="stat-value" th:text="${gameSession.totalRounds > 0} ? ${#numbers.formatDecimal(gameSession.correctCount * 100.0 / gameSession.totalRounds, 1, 0)} + '%' : '0%'"></span>
            </div>
        </div>

        <div class="rounds-section">
            <h3>ë¼ìš´ë“œ ê¸°ë¡</h3>
            <div class="rounds-grid">
                <div th:each="round : ${rounds}" class="round-card"
                     th:classappend="${round.status.name() == 'SKIPPED'} ? 'skipped' : 'answered'">
                    <div class="round-header">
                        <span class="round-num" th:text="'#' + ${round.roundNumber}"></span>
                        <span th:if="${round.status.name() == 'ANSWERED'}" class="round-status correct">ì •ë‹µ</span>
                        <span th:if="${round.status.name() == 'SKIPPED'}" class="round-status skip">ìŠ¤í‚µ</span>
                    </div>
                    <div class="round-body">
                        <div class="song-info">
                            <div class="song-title" th:text="${round.song != null} ? ${round.song.title} : '-'"></div>
                            <div class="song-artist" th:text="${round.song != null} ? ${round.song.artist} : ''"></div>
                        </div>
                        <div th:if="${round.status.name() == 'ANSWERED'}" class="winner-info">
                            <span class="winner-label">ì •ë‹µì</span>
                            <span class="winner-name" th:text="${round.userAnswer}"></span>
                        </div>
                        <button th:if="${round.song != null}" class="btn-report-small" th:data-song-id="${round.song.id}" onclick="openReportModal(this.dataset.songId)">ì‹ ê³ </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="all-scores desktop-only" th:if="${#lists.size(playerScores) > 3}">
            <h3>ì „ì²´ ìˆœìœ„</h3>
            <div class="score-table">
                <div th:each="entry : ${playerScores}" class="score-row">
                    <span class="rank" th:text="${entry.rank} + 'ìœ„'"></span>
                    <span class="name" th:text="${entry.name}"></span>
                    <span class="score" th:text="${entry.score} + 'ì '"></span>
                </div>
            </div>
        </div>
    </main>

    <footer class="result-footer">
        <a href="/game/solo/host" class="btn btn-replay">ë‹¤ì‹œ í•˜ê¸° ğŸ”„</a>
        <a href="/" class="btn btn-home">í™ˆìœ¼ë¡œ ğŸ </a>
    </footer>
</div>

<script th:src="@{/js/common/common.js}"></script>

<!-- ì‹ ê³  ëª¨ë‹¬ -->
<th:block th:replace="~{common/fragments/report-modal :: reportModal}"></th:block>

<style>
/* ì‹ ê³  ë²„íŠ¼ - round-body í•˜ë‹¨ì— ë°°ì¹˜ */
.btn-report-small {
    display: block;
    margin-top: 0.5rem;
    padding: 4px 8px;
    font-size: 0.7em;
    background: transparent;
    color: var(--text-secondary);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    cursor: pointer;
    opacity: 0.7;
    transition: all 0.2s;
}
.btn-report-small:hover {
    opacity: 1;
    background: rgba(239, 68, 68, 0.1);
    color: var(--danger);
    border-color: var(--danger);
}
.round-card {
    position: relative;
}

/* ë‹¤í¬ëª¨ë“œ - í¬ë””ì›€/ë­í‚¹ ì´ë¦„ ìƒ‰ìƒ ìˆ˜ì • (ë°ì€ ë°°ê²½ì—ì„œ ì½ê¸° ì‰½ê²Œ) */
[data-theme="dark"] .podium-place .place-name {
    color: #1e293b;
}
[data-theme="dark"] .podium-place .place-score {
    color: #4f46e5;
}
[data-theme="dark"] .podium-place .place-stand {
    color: #475569;
}

/* ë¼ì´íŠ¸ëª¨ë“œ - ì •ë‹µì ë°•ìŠ¤ ê°€ì‹œì„± ê°œì„  */
.winner-info {
    background: rgba(34, 197, 94, 0.1);
    padding: 0.5rem 0.75rem;
    border-radius: 0.375rem;
    border-top: none;
    margin-top: 0.5rem;
}
.winner-label {
    color: #166534;
    font-weight: 500;
}
.winner-name {
    color: #15803d;
}

/* ë‹¤í¬ëª¨ë“œ - ë¼ìš´ë“œ ì¹´ë“œ ì •ë‹µì ì´ë¦„ */
[data-theme="dark"] .winner-info {
    background: rgba(34, 197, 94, 0.15);
    border-top: none;
}
[data-theme="dark"] .winner-name {
    color: #4ade80;
}
[data-theme="dark"] .winner-label {
    color: #86efac;
}
</style>
</body>
</html>