<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common/fragments/head :: clientHead('Î†àÌä∏Î°ú Í≤åÏûÑ - Í≤∞Í≥º')}"></head>
<link rel="stylesheet" th:href="@{/css/client/result.css}">
<body class="client-page result-page">
<div class="result-container">
    <header class="result-header">
        <h1>üéÆ Í≤åÏûÑ Í≤∞Í≥º</h1>
        <p th:text="${nickname}"></p>
    </header>

    <main class="result-main">
        <!-- Ï†êÏàò ÏÑπÏÖò -->
        <div class="score-section">
            <div class="final-score">
                <span class="score-label">ÏµúÏ¢Ö Ï†êÏàò</span>
                <span class="score-value" th:text="${gameSession.totalScore}">0</span>
            </div>
        </div>

        <!-- ÌÜµÍ≥Ñ Î∞î - Ìïú Ï§Ñ -->
        <div class="stats-bar">
            <div class="stat-item">
                <span class="stat-label">Ï†ïÎãµ</span>
                <span class="stat-value correct" th:text="${gameSession.correctCount}">0</span>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
                <span class="stat-label">Ïò§Îãµ</span>
                <span class="stat-value wrong" th:text="${gameSession.completedRounds - gameSession.correctCount - gameSession.skipCount}">0</span>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
                <span class="stat-label">Ïä§ÌÇµ</span>
                <span class="stat-value skip" th:text="${gameSession.skipCount}">0</span>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
                <span class="stat-label">Ï†ïÎãµÎ•†</span>
                <span class="stat-value" th:text="${#numbers.formatDecimal(gameSession.accuracyRate, 1, 1) + '%'}">0%</span>
            </div>
        </div>

        <!-- ÎùºÏö¥Îìú Í∏∞Î°ù - Ïπ¥Îìú Í∑∏Î¶¨Îìú -->
        <div class="rounds-section">
            <h3>ÎùºÏö¥Îìú Í∏∞Î°ù</h3>
            <div class="rounds-grid">
                <div th:each="round : ${rounds}" class="round-card"
                     th:classappend="${round.isCorrect ? 'correct' : (round.status.name() == 'SKIPPED' ? 'skipped' : 'wrong')}">
                    <div class="round-header">
                        <span class="round-num" th:text="'#' + ${round.roundNumber}"></span>
                        <span th:if="${round.isCorrect}" class="round-status correct">Ï†ïÎãµ</span>
                        <span th:if="${round.status.name() == 'SKIPPED'}" class="round-status skip">Ïä§ÌÇµ</span>
                        <span th:if="${!round.isCorrect && round.status.name() != 'SKIPPED'}" class="round-status wrong">Ïò§Îãµ</span>
                    </div>
                    <div class="round-body">
                        <div class="song-info">
                            <div class="song-title" th:text="${round.song.title}"></div>
                            <div class="song-artist" th:text="${round.song.artist}"></div>
                        </div>
                        <div th:if="${round.isCorrect}" class="score-info">
                            <span class="score-plus" th:text="'+' + ${round.score} + 'Ï†ê'"></span>
                            <span th:if="${round.answerTimeMs != null}" class="attempt-info" th:text="'(' + ${#numbers.formatDecimal(round.answerTimeMs / 1000.0, 1, 1)} + 'Ï¥à)'"></span>
                        </div>
                        <div th:if="${!round.isCorrect && round.status.name() != 'SKIPPED'}" class="fail-info">
                            <span class="fail-text">3Ìöå Ïã§Ìå®</span>
                        </div>
                        <!-- ÏãúÎèÑ ÎÇ¥Ïó≠ ÌëúÏãú (Ïò§Îãµ/Ï†ïÎãµ Î™®Îëê) -->
                        <div th:if="${round.attempts != null && !round.attempts.isEmpty()}" class="attempts-section">
                            <div class="attempts-label">ÎÇ¥ ÎãµÎ≥Ä:</div>
                            <div class="attempts-list">
                                <div th:each="attempt : ${round.attempts}" class="attempt-item"
                                     th:classappend="${attempt.isCorrect} ? 'correct' : 'wrong'">
                                    <span class="attempt-num" th:text="${attempt.attemptNumber} + 'Ï∞®'"></span>
                                    <span class="attempt-answer" th:text="${attempt.userAnswer}"></span>
                                    <span th:if="${attempt.isCorrect}" class="attempt-result correct">O</span>
                                    <span th:if="${!attempt.isCorrect}" class="attempt-result wrong">X</span>
                                </div>
                            </div>
                        </div>
                        <button class="btn-report-small" th:data-song-id="${round.song.id}" onclick="openReportModal(this.dataset.songId)">Ïã†Í≥†</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="result-footer">
        <a href="/game/retro" class="btn btn-replay">Îã§Ïãú ÌïòÍ∏∞ üîÑ</a>
        <a href="/" class="btn btn-home">ÌôàÏúºÎ°ú üè†</a>
    </footer>
</div>

<!-- Ïã†Í≥† Î™®Îã¨ -->
<th:block th:replace="~{common/fragments/report-modal :: reportModal}"></th:block>
</body>
</html>
