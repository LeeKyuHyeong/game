<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common/fragments/head :: clientHead('ëŒ€ê¸°ì‹¤ - Song Quiz')}"></head>
<body class="client-page">
<div class="client-container">
    <header class="waiting-header">
        <nav class="header-nav">
            <a href="/" class="btn-home">ğŸ  í™ˆ</a>
        </nav>
        <div class="room-title-section">
            <h1 th:text="${room.roomName}">ë°© ì´ë¦„</h1>
            <div class="room-code-display">
                <span class="code-label">ì°¸ê°€ ì½”ë“œ</span>
                <span class="code-value" th:text="${room.roomCode}">ABCD12</span>
                <button type="button" class="btn btn-copy" onclick="copyRoomCode()">ğŸ“‹</button>
            </div>
        </div>
        <div class="room-settings-info">
            <span class="setting-item">ğŸ¯ <span th:text="${room.totalRounds}">10</span> ë¼ìš´ë“œ</span>
            <span class="setting-item">ğŸ‘¥ ìµœëŒ€ <span th:text="${room.maxPlayers}">8</span>ëª…</span>
        </div>
    </header>

    <main class="waiting-main with-chat">
        <!-- ì¢Œì¸¡: ì°¸ê°€ì + ë²„íŠ¼ -->
        <div class="waiting-left">
            <div class="participants-section">
                <h2>ì°¸ê°€ì ëª©ë¡</h2>
                <div class="participants-grid" id="participantsList">
                    <div th:each="p : ${participants}" class="participant-card"
                         th:classappend="${p.isReady} ? 'ready' : ''"
                         th:data-member-id="${p.member.id}">
                        <div class="participant-info">
                            <span class="participant-icon" th:if="${room.isHost(p.member)}">ğŸ‘‘</span>
                            <span class="participant-icon" th:unless="${room.isHost(p.member)}">ğŸ‘¤</span>
                            <span class="participant-name" th:text="${p.member.nickname}">ë‹‰ë„¤ì„</span>
                        </div>
                        <div class="participant-status">
                            <span th:if="${room.isHost(p.member)}" class="status-badge host">ë°©ì¥</span>
                            <span th:unless="${room.isHost(p.member)}"
                                  class="status-badge"
                                  th:classappend="${p.isReady} ? 'ready' : 'waiting'"
                                  th:text="${p.isReady} ? 'ì¤€ë¹„ì™„ë£Œ' : 'ëŒ€ê¸°ì¤‘'">ëŒ€ê¸°ì¤‘</span>
                        </div>
                        <!-- ë°©ì¥ì¼ ë•Œ ê°•í‡´ ë²„íŠ¼ (ë³¸ì¸ ì œì™¸) -->
                        <button th:if="${isHost and !room.isHost(p.member)}"
                                type="button"
                                class="btn btn-kick"
                                th:data-id="${p.member.id}"
                                onclick="kickPlayer(this.dataset.id)">ê°•í‡´</button>
                    </div>
                </div>
            </div>

            <div class="waiting-actions">
                <!-- ë°©ì¥ì´ ì•„ë‹Œ ê²½ìš° ì¤€ë¹„ ë²„íŠ¼ -->
                <button th:if="${!isHost and myParticipant != null}"
                        type="button"
                        class="btn btn-ready"
                        id="readyBtn"
                        th:classappend="${myParticipant.isReady} ? 'is-ready' : ''"
                        onclick="toggleReady()">
                    <span th:if="${myParticipant.isReady}">âœ… ì¤€ë¹„ ì™„ë£Œ</span>
                    <span th:unless="${myParticipant.isReady}">ğŸ® ì¤€ë¹„í•˜ê¸°</span>
                </button>

                <!-- ë°©ì¥ì¸ ê²½ìš° ê²Œì„ ì‹œì‘ ë²„íŠ¼ -->
                <button th:if="${isHost}"
                        type="button"
                        class="btn btn-start-game"
                        id="startGameBtn"
                        onclick="startGame()">
                    ğŸš€ ê²Œì„ ì‹œì‘
                </button>

                <button type="button" class="btn btn-leave" onclick="leaveRoom()">ë‚˜ê°€ê¸°</button>
            </div>
        </div>

        <!-- ìš°ì¸¡: ì±„íŒ… -->
        <div class="waiting-chat">
            <div class="chat-header">
                <h3>ğŸ’¬ ì±„íŒ…</h3>
            </div>
            <div class="chat-messages" id="chatMessages">
                <!-- ì±„íŒ… ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            <div class="chat-input-area">
                <input type="text" id="chatInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                       maxlength="200" autocomplete="off"
                       onkeypress="if(event.key === 'Enter') sendChat()">
                <button type="button" class="btn btn-send" onclick="sendChat()">ì „ì†¡</button>
            </div>
        </div>
    </main>
</div>

<script th:inline="javascript">
    const roomCode = [[${room.roomCode}]];
    const myMemberId = [[${member.id}]];
    const myNickname = [[${member.nickname}]];
    const isHost = [[${isHost}]];
</script>
<script th:src="@{/js/common/common.js}"></script>
<script th:src="@{/js/client/multi-waiting.js}"></script>
</body>
</html>