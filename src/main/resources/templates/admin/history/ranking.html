<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common/fragments/head :: adminHead('랭킹')}"></head>
<link rel="stylesheet" href="/css/admin/mobile-stats.css">
<link rel="stylesheet" th:href="@{/css/admin/ranking-tier.css}">
<body class="admin-page ranking-mobile">
<div class="admin-container">
    <th:block th:replace="~{admin/layout/sidebar :: sidebar}"></th:block>
    <main class="main-content">
        <header class="content-header">
            <h1>🏆 랭킹</h1>
        </header>

        <!-- Tier Distribution Dashboard -->
        <div class="tier-dashboard">
            <h2>🎖️ 티어 분포 현황 <span style="font-size: 0.9rem; color: rgba(255,255,255,0.5);">총 [[${totalMembers}]]명</span></h2>
            <div class="tier-cards">
                <div class="tier-card MASTER">
                    <div class="tier-icon">👑</div>
                    <div class="tier-name">MASTER</div>
                    <div class="tier-count" th:text="${tierDistribution['MASTER']}">0</div>
                    <div class="tier-percent" th:text="${totalMembers > 0} ? ${#numbers.formatDecimal(tierDistribution['MASTER'] * 100.0 / totalMembers, 0, 1)} + '%' : '0%'"></div>
                </div>
                <div class="tier-card DIAMOND">
                    <div class="tier-icon">💎</div>
                    <div class="tier-name">DIAMOND</div>
                    <div class="tier-count" th:text="${tierDistribution['DIAMOND']}">0</div>
                    <div class="tier-percent" th:text="${totalMembers > 0} ? ${#numbers.formatDecimal(tierDistribution['DIAMOND'] * 100.0 / totalMembers, 0, 1)} + '%' : '0%'"></div>
                </div>
                <div class="tier-card PLATINUM">
                    <div class="tier-icon">🔮</div>
                    <div class="tier-name">PLATINUM</div>
                    <div class="tier-count" th:text="${tierDistribution['PLATINUM']}">0</div>
                    <div class="tier-percent" th:text="${totalMembers > 0} ? ${#numbers.formatDecimal(tierDistribution['PLATINUM'] * 100.0 / totalMembers, 0, 1)} + '%' : '0%'"></div>
                </div>
                <div class="tier-card GOLD">
                    <div class="tier-icon">🏅</div>
                    <div class="tier-name">GOLD</div>
                    <div class="tier-count" th:text="${tierDistribution['GOLD']}">0</div>
                    <div class="tier-percent" th:text="${totalMembers > 0} ? ${#numbers.formatDecimal(tierDistribution['GOLD'] * 100.0 / totalMembers, 0, 1)} + '%' : '0%'"></div>
                </div>
                <div class="tier-card SILVER">
                    <div class="tier-icon">🥈</div>
                    <div class="tier-name">SILVER</div>
                    <div class="tier-count" th:text="${tierDistribution['SILVER']}">0</div>
                    <div class="tier-percent" th:text="${totalMembers > 0} ? ${#numbers.formatDecimal(tierDistribution['SILVER'] * 100.0 / totalMembers, 0, 1)} + '%' : '0%'"></div>
                </div>
                <div class="tier-card BRONZE">
                    <div class="tier-icon">🥉</div>
                    <div class="tier-name">BRONZE</div>
                    <div class="tier-count" th:text="${tierDistribution['BRONZE']}">0</div>
                    <div class="tier-percent" th:text="${totalMembers > 0} ? ${#numbers.formatDecimal(tierDistribution['BRONZE'] * 100.0 / totalMembers, 0, 1)} + '%' : '0%'"></div>
                </div>
            </div>
            <div class="tier-chart">
                <h3>📊 티어별 회원 분포</h3>
                <div class="chart-bars">
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">MASTER</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar MASTER" th:style="${totalMembers > 0} ? 'width:' + ${tierDistribution['MASTER'] * 100.0 / totalMembers} + '%' : 'width:0%'" th:text="${tierDistribution['MASTER']}"></div>
                        </div>
                    </div>
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">DIAMOND</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar DIAMOND" th:style="${totalMembers > 0} ? 'width:' + ${tierDistribution['DIAMOND'] * 100.0 / totalMembers} + '%' : 'width:0%'" th:text="${tierDistribution['DIAMOND']}"></div>
                        </div>
                    </div>
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">PLATINUM</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar PLATINUM" th:style="${totalMembers > 0} ? 'width:' + ${tierDistribution['PLATINUM'] * 100.0 / totalMembers} + '%' : 'width:0%'" th:text="${tierDistribution['PLATINUM']}"></div>
                        </div>
                    </div>
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">GOLD</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar GOLD" th:style="${totalMembers > 0} ? 'width:' + ${tierDistribution['GOLD'] * 100.0 / totalMembers} + '%' : 'width:0%'" th:text="${tierDistribution['GOLD']}"></div>
                        </div>
                    </div>
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">SILVER</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar SILVER" th:style="${totalMembers > 0} ? 'width:' + ${tierDistribution['SILVER'] * 100.0 / totalMembers} + '%' : 'width:0%'" th:text="${tierDistribution['SILVER']}"></div>
                        </div>
                    </div>
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">BRONZE</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar BRONZE" th:style="${totalMembers > 0} ? 'width:' + ${tierDistribution['BRONZE'] * 100.0 / totalMembers} + '%' : 'width:0%'" th:text="${tierDistribution['BRONZE']}"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rank Type Tabs -->
        <div class="rank-type-tabs">
            <a th:href="@{/admin/history/ranking(rankType='total')}" th:classappend="${rankType == 'total' or rankType == null} ? 'active'" class="rank-type-tab">🏆 전체 랭킹</a>
            <a th:href="@{/admin/history/ranking(rankType='guess')}" th:classappend="${rankType == 'guess'} ? 'active'" class="rank-type-tab">🎵 내가맞추기</a>
            <a th:href="@{/admin/history/ranking(rankType='multi')}" th:classappend="${rankType == 'multi'} ? 'active'" class="rank-type-tab">👥 멀티게임</a>
            <a th:href="@{/admin/history/ranking(rankType='weekly')}" th:classappend="${rankType == 'weekly'} ? 'active'" class="rank-type-tab">📅 주간</a>
            <a th:href="@{/admin/history/ranking(rankType='best')}" th:classappend="${rankType == 'best'} ? 'active'" class="rank-type-tab">⭐ 최고기록</a>
        </div>

        <!-- TOP 10 Rankers -->
        <div class="top-rankers" th:if="${!#lists.isEmpty(memberRankings)}">
            <th:block th:each="member, idx : ${memberRankings}" th:if="${idx.index < 10}">
                <div class="ranker-card" th:classappend="${idx.index == 0} ? 'top-1' : (${idx.index == 1} ? 'top-2' : (${idx.index == 2} ? 'top-3' : ''))">
                    <div class="ranker-rank">
                        <span th:if="${idx.index == 0}">🥇 1위</span>
                        <span th:if="${idx.index == 1}">🥈 2위</span>
                        <span th:if="${idx.index == 2}">🥉 3위</span>
                        <span th:if="${idx.index > 2}" th:text="${idx.index + 1} + '위'"></span>
                    </div>
                    <div class="ranker-tier-badge" th:classappend="${member.tier?.name()}" th:text="${member.tier?.name()}">BRONZE</div>
                    <div class="ranker-nickname" th:text="${member.nickname}">닉네임</div>
                    <div class="ranker-score" th:text="${member.totalScore} + '점'">0점</div>
                    <div class="ranker-stats">
                        게임 <span th:text="${member.totalGames}">0</span>회 |
                        정답률 <span th:text="${#numbers.formatDecimal(member.accuracyRate, 0, 1)}">0</span>%
                    </div>
                </div>
            </th:block>
        </div>

        <!-- Ranking Table -->
        <div class="ranking-table-container">
            <table class="member-ranking-table">
                <thead>
                <tr>
                    <th style="width: 60px;">순위</th>
                    <th style="width: 80px;">티어</th>
                    <th>닉네임</th>
                    <th>점수</th>
                    <th>게임수</th>
                    <th>정답률</th>
                    <th>가입일</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="member, idx : ${memberRankings}">
                    <td>
                        <span th:if="${idx.index == 0}" class="rank-medal">🥇</span>
                        <span th:if="${idx.index == 1}" class="rank-medal">🥈</span>
                        <span th:if="${idx.index == 2}" class="rank-medal">🥉</span>
                        <span th:if="${idx.index > 2}" th:text="${idx.index + 1}"></span>
                    </td>
                    <td>
                        <span class="table-tier-badge" th:classappend="${member.tier?.name()}" th:text="${member.tier?.name()}">BRONZE</span>
                    </td>
                    <td th:text="${member.nickname}">닉네임</td>
                    <td th:text="${#numbers.formatInteger(member.totalScore, 0, 'COMMA')}">0</td>
                    <td th:text="${member.totalGames}">0</td>
                    <td th:text="${#numbers.formatDecimal(member.accuracyRate, 0, 1)} + '%'">0%</td>
                    <td th:text="${member.createdAt != null} ? ${#temporals.format(member.createdAt, 'yyyy-MM-dd')} : '-'">-</td>
                </tr>
                <tr th:if="${#lists.isEmpty(memberRankings)}">
                    <td colspan="7" style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
                        랭킹 데이터가 없습니다.
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </main>
</div>
<script th:src="@{/js/common/common.js}"></script>
</body>
</html>
