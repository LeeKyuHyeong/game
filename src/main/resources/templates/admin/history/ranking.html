<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common/fragments/head :: adminHead('Îû≠ÌÇπ')}"></head>
<link rel="stylesheet" href="/css/admin/mobile-stats.css">
<link rel="stylesheet" th:href="@{/css/admin/ranking-tier.css}">
<body class="admin-page ranking-mobile">
<div class="admin-container">
    <th:block th:replace="~{admin/layout/sidebar :: sidebar}"></th:block>
    <main class="main-content">
        <header class="content-header">
            <h1>üèÜ Îû≠ÌÇπ</h1>
        </header>

        <!-- Tier Distribution Dashboard -->
        <div class="tier-dashboard" th:if="${rankType != 'multi'}">
            <h2>ÌÜµÌï© Ìã∞Ïñ¥ Î∂ÑÌè¨ ÌòÑÌô© <span style="font-size: 0.9rem; color: rgba(255,255,255,0.5);">Ï¥ù [[${totalMembers}]]Î™Ö</span></h2>
            <div class="tier-cards">
                <div class="tier-card MASTER">
                    <div class="tier-icon">üëë</div>
                    <div class="tier-name">MASTER</div>
                    <div class="tier-count" th:text="${tierDistribution['MASTER']}">0</div>
                    <div class="tier-percent" th:text="${totalMembers > 0} ? ${#numbers.formatDecimal(tierDistribution['MASTER'] * 100.0 / totalMembers, 0, 1)} + '%' : '0%'"></div>
                </div>
                <div class="tier-card DIAMOND">
                    <div class="tier-icon">üíé</div>
                    <div class="tier-name">DIAMOND</div>
                    <div class="tier-count" th:text="${tierDistribution['DIAMOND']}">0</div>
                    <div class="tier-percent" th:text="${totalMembers > 0} ? ${#numbers.formatDecimal(tierDistribution['DIAMOND'] * 100.0 / totalMembers, 0, 1)} + '%' : '0%'"></div>
                </div>
                <div class="tier-card PLATINUM">
                    <div class="tier-icon">üîÆ</div>
                    <div class="tier-name">PLATINUM</div>
                    <div class="tier-count" th:text="${tierDistribution['PLATINUM']}">0</div>
                    <div class="tier-percent" th:text="${totalMembers > 0} ? ${#numbers.formatDecimal(tierDistribution['PLATINUM'] * 100.0 / totalMembers, 0, 1)} + '%' : '0%'"></div>
                </div>
                <div class="tier-card GOLD">
                    <div class="tier-icon">üèÖ</div>
                    <div class="tier-name">GOLD</div>
                    <div class="tier-count" th:text="${tierDistribution['GOLD']}">0</div>
                    <div class="tier-percent" th:text="${totalMembers > 0} ? ${#numbers.formatDecimal(tierDistribution['GOLD'] * 100.0 / totalMembers, 0, 1)} + '%' : '0%'"></div>
                </div>
                <div class="tier-card SILVER">
                    <div class="tier-icon">ü•à</div>
                    <div class="tier-name">SILVER</div>
                    <div class="tier-count" th:text="${tierDistribution['SILVER']}">0</div>
                    <div class="tier-percent" th:text="${totalMembers > 0} ? ${#numbers.formatDecimal(tierDistribution['SILVER'] * 100.0 / totalMembers, 0, 1)} + '%' : '0%'"></div>
                </div>
                <div class="tier-card BRONZE">
                    <div class="tier-icon">ü•â</div>
                    <div class="tier-name">BRONZE</div>
                    <div class="tier-count" th:text="${tierDistribution['BRONZE']}">0</div>
                    <div class="tier-percent" th:text="${totalMembers > 0} ? ${#numbers.formatDecimal(tierDistribution['BRONZE'] * 100.0 / totalMembers, 0, 1)} + '%' : '0%'"></div>
                </div>
            </div>
            <div class="tier-chart">
                <h3>Ìã∞Ïñ¥Î≥Ñ ÌöåÏõê Î∂ÑÌè¨</h3>
                <div class="chart-bars">
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">MASTER</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar MASTER" th:style="${totalMembers > 0} ? 'width:' + ${tierDistribution['MASTER'] * 100.0 / totalMembers} + '%' : 'width:0%'" th:text="${tierDistribution['MASTER']}"></div>
                        </div>
                    </div>
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">DIAMOND</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar DIAMOND" th:style="${totalMembers > 0} ? 'width:' + ${tierDistribution['DIAMOND'] * 100.0 / totalMembers} + '%' : 'width:0%'" th:text="${tierDistribution['DIAMOND']}"></div>
                        </div>
                    </div>
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">PLATINUM</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar PLATINUM" th:style="${totalMembers > 0} ? 'width:' + ${tierDistribution['PLATINUM'] * 100.0 / totalMembers} + '%' : 'width:0%'" th:text="${tierDistribution['PLATINUM']}"></div>
                        </div>
                    </div>
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">GOLD</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar GOLD" th:style="${totalMembers > 0} ? 'width:' + ${tierDistribution['GOLD'] * 100.0 / totalMembers} + '%' : 'width:0%'" th:text="${tierDistribution['GOLD']}"></div>
                        </div>
                    </div>
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">SILVER</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar SILVER" th:style="${totalMembers > 0} ? 'width:' + ${tierDistribution['SILVER'] * 100.0 / totalMembers} + '%' : 'width:0%'" th:text="${tierDistribution['SILVER']}"></div>
                        </div>
                    </div>
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">BRONZE</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar BRONZE" th:style="${totalMembers > 0} ? 'width:' + ${tierDistribution['BRONZE'] * 100.0 / totalMembers} + '%' : 'width:0%'" th:text="${tierDistribution['BRONZE']}"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Multi LP Tier Distribution Dashboard -->
        <div class="tier-dashboard" th:if="${rankType == 'multi'}">
            <h2>Î©ÄÌã∞Í≤åÏûÑ LP Ìã∞Ïñ¥ Î∂ÑÌè¨ <span style="font-size: 0.9rem; color: rgba(255,255,255,0.5);">Ï¥ù [[${totalMultiPlayers}]]Î™Ö</span></h2>
            <div class="tier-cards" style="grid-template-columns: repeat(7, 1fr);">
                <div class="tier-card" style="background: linear-gradient(135deg, #00BFFF 0%, #1E90FF 100%);">
                    <div class="tier-icon">üèÜ</div>
                    <div class="tier-name">CHALLENGER</div>
                    <div class="tier-count" th:text="${multiTierDistribution['CHALLENGER']}">0</div>
                    <div class="tier-percent" th:text="${totalMultiPlayers > 0} ? ${#numbers.formatDecimal(multiTierDistribution['CHALLENGER'] * 100.0 / totalMultiPlayers, 0, 1)} + '%' : '0%'"></div>
                </div>
                <div class="tier-card" style="background: linear-gradient(135deg, #FF6B6B 0%, #EE5A5A 100%);">
                    <div class="tier-icon">üëë</div>
                    <div class="tier-name">MASTER</div>
                    <div class="tier-count" th:text="${multiTierDistribution['MASTER']}">0</div>
                    <div class="tier-percent" th:text="${totalMultiPlayers > 0} ? ${#numbers.formatDecimal(multiTierDistribution['MASTER'] * 100.0 / totalMultiPlayers, 0, 1)} + '%' : '0%'"></div>
                </div>
                <div class="tier-card" style="background: linear-gradient(135deg, #B9F2FF 0%, #87CEEB 100%);">
                    <div class="tier-icon">üíé</div>
                    <div class="tier-name">DIAMOND</div>
                    <div class="tier-count" th:text="${multiTierDistribution['DIAMOND']}">0</div>
                    <div class="tier-percent" th:text="${totalMultiPlayers > 0} ? ${#numbers.formatDecimal(multiTierDistribution['DIAMOND'] * 100.0 / totalMultiPlayers, 0, 1)} + '%' : '0%'"></div>
                </div>
                <div class="tier-card" style="background: linear-gradient(135deg, #E5E4E2 0%, #C0C0C0 100%);">
                    <div class="tier-icon">üîÆ</div>
                    <div class="tier-name">PLATINUM</div>
                    <div class="tier-count" th:text="${multiTierDistribution['PLATINUM']}">0</div>
                    <div class="tier-percent" th:text="${totalMultiPlayers > 0} ? ${#numbers.formatDecimal(multiTierDistribution['PLATINUM'] * 100.0 / totalMultiPlayers, 0, 1)} + '%' : '0%'"></div>
                </div>
                <div class="tier-card" style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);">
                    <div class="tier-icon">üèÖ</div>
                    <div class="tier-name">GOLD</div>
                    <div class="tier-count" th:text="${multiTierDistribution['GOLD']}">0</div>
                    <div class="tier-percent" th:text="${totalMultiPlayers > 0} ? ${#numbers.formatDecimal(multiTierDistribution['GOLD'] * 100.0 / totalMultiPlayers, 0, 1)} + '%' : '0%'"></div>
                </div>
                <div class="tier-card" style="background: linear-gradient(135deg, #C0C0C0 0%, #A8A8A8 100%);">
                    <div class="tier-icon">ü•à</div>
                    <div class="tier-name">SILVER</div>
                    <div class="tier-count" th:text="${multiTierDistribution['SILVER']}">0</div>
                    <div class="tier-percent" th:text="${totalMultiPlayers > 0} ? ${#numbers.formatDecimal(multiTierDistribution['SILVER'] * 100.0 / totalMultiPlayers, 0, 1)} + '%' : '0%'"></div>
                </div>
                <div class="tier-card" style="background: linear-gradient(135deg, #CD7F32 0%, #B87333 100%);">
                    <div class="tier-icon">ü•â</div>
                    <div class="tier-name">BRONZE</div>
                    <div class="tier-count" th:text="${multiTierDistribution['BRONZE']}">0</div>
                    <div class="tier-percent" th:text="${totalMultiPlayers > 0} ? ${#numbers.formatDecimal(multiTierDistribution['BRONZE'] * 100.0 / totalMultiPlayers, 0, 1)} + '%' : '0%'"></div>
                </div>
            </div>
            <div class="tier-chart">
                <h3>Î©ÄÌã∞Í≤åÏûÑ LP Ìã∞Ïñ¥Î≥Ñ Î∂ÑÌè¨</h3>
                <div class="chart-bars">
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">CHALLENGER</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar" style="background: linear-gradient(90deg, #00BFFF, #1E90FF);" th:style="${totalMultiPlayers > 0} ? 'width:' + ${multiTierDistribution['CHALLENGER'] * 100.0 / totalMultiPlayers} + '%' : 'width:0%'" th:text="${multiTierDistribution['CHALLENGER']}"></div>
                        </div>
                    </div>
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">MASTER</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar" style="background: linear-gradient(90deg, #FF6B6B, #EE5A5A);" th:style="${totalMultiPlayers > 0} ? 'width:' + ${multiTierDistribution['MASTER'] * 100.0 / totalMultiPlayers} + '%' : 'width:0%'" th:text="${multiTierDistribution['MASTER']}"></div>
                        </div>
                    </div>
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">DIAMOND</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar" style="background: linear-gradient(90deg, #B9F2FF, #87CEEB);" th:style="${totalMultiPlayers > 0} ? 'width:' + ${multiTierDistribution['DIAMOND'] * 100.0 / totalMultiPlayers} + '%' : 'width:0%'" th:text="${multiTierDistribution['DIAMOND']}"></div>
                        </div>
                    </div>
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">PLATINUM</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar" style="background: linear-gradient(90deg, #E5E4E2, #C0C0C0);" th:style="${totalMultiPlayers > 0} ? 'width:' + ${multiTierDistribution['PLATINUM'] * 100.0 / totalMultiPlayers} + '%' : 'width:0%'" th:text="${multiTierDistribution['PLATINUM']}"></div>
                        </div>
                    </div>
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">GOLD</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar" style="background: linear-gradient(90deg, #FFD700, #FFA500);" th:style="${totalMultiPlayers > 0} ? 'width:' + ${multiTierDistribution['GOLD'] * 100.0 / totalMultiPlayers} + '%' : 'width:0%'" th:text="${multiTierDistribution['GOLD']}"></div>
                        </div>
                    </div>
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">SILVER</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar" style="background: linear-gradient(90deg, #C0C0C0, #A8A8A8);" th:style="${totalMultiPlayers > 0} ? 'width:' + ${multiTierDistribution['SILVER'] * 100.0 / totalMultiPlayers} + '%' : 'width:0%'" th:text="${multiTierDistribution['SILVER']}"></div>
                        </div>
                    </div>
                    <div class="chart-bar-row">
                        <span class="chart-bar-label">BRONZE</span>
                        <div class="chart-bar-container">
                            <div class="chart-bar" style="background: linear-gradient(90deg, #CD7F32, #B87333);" th:style="${totalMultiPlayers > 0} ? 'width:' + ${multiTierDistribution['BRONZE'] * 100.0 / totalMultiPlayers} + '%' : 'width:0%'" th:text="${multiTierDistribution['BRONZE']}"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rank Type Tabs -->
        <div class="rank-type-tabs">
            <a th:href="@{/admin/history/ranking(rankType='total')}" th:classappend="${rankType == 'total' or rankType == null} ? 'active'" class="rank-type-tab">üèÜ Ï†ÑÏ≤¥ Îû≠ÌÇπ</a>
            <a th:href="@{/admin/history/ranking(rankType='guess')}" th:classappend="${rankType == 'guess'} ? 'active'" class="rank-type-tab">üéµ ÎÇ¥Í∞ÄÎßûÏ∂îÍ∏∞</a>
            <a th:href="@{/admin/history/ranking(rankType='multi')}" th:classappend="${rankType == 'multi'} ? 'active'" class="rank-type-tab">üë• Î©ÄÌã∞Í≤åÏûÑ</a>
            <a th:href="@{/admin/history/ranking(rankType='weekly')}" th:classappend="${rankType == 'weekly'} ? 'active'" class="rank-type-tab">üìÖ Ï£ºÍ∞Ñ</a>
            <a th:href="@{/admin/history/ranking(rankType='best')}" th:classappend="${rankType == 'best'} ? 'active'" class="rank-type-tab">‚≠ê ÏµúÍ≥†Í∏∞Î°ù</a>
        </div>

        <!-- TOP 10 Rankers (Non-Multi) -->
        <div class="top-rankers" th:if="${!#lists.isEmpty(memberRankings) and rankType != 'multi'}">
            <th:block th:each="member, idx : ${memberRankings}" th:if="${idx.index < 10}">
                <div class="ranker-card" th:classappend="${idx.index == 0} ? 'top-1' : (${idx.index == 1} ? 'top-2' : (${idx.index == 2} ? 'top-3' : ''))">
                    <div class="ranker-rank">
                        <span th:if="${idx.index == 0}">ü•á 1ÏúÑ</span>
                        <span th:if="${idx.index == 1}">ü•à 2ÏúÑ</span>
                        <span th:if="${idx.index == 2}">ü•â 3ÏúÑ</span>
                        <span th:if="${idx.index > 2}" th:text="${idx.index + 1} + 'ÏúÑ'"></span>
                    </div>
                    <div class="ranker-tier-badge" th:classappend="${member.tier?.name()}" th:text="${member.tier?.name()}">BRONZE</div>
                    <div class="ranker-nickname" th:text="${member.nickname}">ÎãâÎÑ§ÏûÑ</div>
                    <div class="ranker-score" th:text="${member.totalScore} + 'Ï†ê'">0Ï†ê</div>
                    <div class="ranker-stats">
                        Í≤åÏûÑ <span th:text="${member.totalGames}">0</span>Ìöå |
                        Ï†ïÎãµÎ•† <span th:text="${#numbers.formatDecimal(member.accuracyRate, 0, 1)}">0</span>%
                    </div>
                </div>
            </th:block>
        </div>

        <!-- TOP 10 Rankers (Multi - LP Tier) -->
        <div class="top-rankers" th:if="${!#lists.isEmpty(memberRankings) and rankType == 'multi'}">
            <th:block th:each="member, idx : ${memberRankings}" th:if="${idx.index < 10}">
                <div class="ranker-card" th:classappend="${idx.index == 0} ? 'top-1' : (${idx.index == 1} ? 'top-2' : (${idx.index == 2} ? 'top-3' : ''))">
                    <div class="ranker-rank">
                        <span th:if="${idx.index == 0}">ü•á 1ÏúÑ</span>
                        <span th:if="${idx.index == 1}">ü•à 2ÏúÑ</span>
                        <span th:if="${idx.index == 2}">ü•â 3ÏúÑ</span>
                        <span th:if="${idx.index > 2}" th:text="${idx.index + 1} + 'ÏúÑ'"></span>
                    </div>
                    <div class="ranker-tier-badge" th:style="'background-color:' + ${member.multiTierColor}" th:text="${member.multiTierDisplayName}">Î∏åÎ°†Ï¶à</div>
                    <div class="ranker-nickname" th:text="${member.nickname}">ÎãâÎÑ§ÏûÑ</div>
                    <div class="ranker-score" th:text="${member.multiLp} + ' LP'">0 LP</div>
                    <div class="ranker-stats">
                        1ÏúÑ <span th:text="${member.multiWins}">0</span>Ìöå |
                        TOP3 <span th:text="${member.multiTop3}">0</span>Ìöå
                    </div>
                </div>
            </th:block>
        </div>

        <!-- Ranking Table (Non-Multi) -->
        <div class="ranking-table-container" th:if="${rankType != 'multi'}">
            <table class="member-ranking-table">
                <thead>
                <tr>
                    <th style="width: 60px;">ÏàúÏúÑ</th>
                    <th style="width: 80px;">Ìã∞Ïñ¥</th>
                    <th>ÎãâÎÑ§ÏûÑ</th>
                    <th>Ï†êÏàò</th>
                    <th>Í≤åÏûÑÏàò</th>
                    <th>Ï†ïÎãµÎ•†</th>
                    <th>Í∞ÄÏûÖÏùº</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="member, idx : ${memberRankings}">
                    <td>
                        <span th:if="${idx.index == 0}" class="rank-medal">ü•á</span>
                        <span th:if="${idx.index == 1}" class="rank-medal">ü•à</span>
                        <span th:if="${idx.index == 2}" class="rank-medal">ü•â</span>
                        <span th:if="${idx.index > 2}" th:text="${idx.index + 1}"></span>
                    </td>
                    <td>
                        <span class="table-tier-badge" th:classappend="${member.tier?.name()}" th:text="${member.tier?.name()}">BRONZE</span>
                    </td>
                    <td th:text="${member.nickname}">ÎãâÎÑ§ÏûÑ</td>
                    <td th:text="${#numbers.formatInteger(member.totalScore, 0, 'COMMA')}">0</td>
                    <td th:text="${member.totalGames}">0</td>
                    <td th:text="${#numbers.formatDecimal(member.accuracyRate, 0, 1)} + '%'">0%</td>
                    <td th:text="${member.createdAt != null} ? ${#temporals.format(member.createdAt, 'yyyy-MM-dd')} : '-'">-</td>
                </tr>
                <tr th:if="${#lists.isEmpty(memberRankings)}">
                    <td colspan="7" style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
                        Îû≠ÌÇπ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Ranking Table (Multi - LP Tier) -->
        <div class="ranking-table-container" th:if="${rankType == 'multi'}">
            <table class="member-ranking-table">
                <thead>
                <tr>
                    <th style="width: 60px;">ÏàúÏúÑ</th>
                    <th style="width: 100px;">LP Ìã∞Ïñ¥</th>
                    <th>ÎãâÎÑ§ÏûÑ</th>
                    <th>LP</th>
                    <th>1ÏúÑ</th>
                    <th>TOP3</th>
                    <th>Í≤åÏûÑÏàò</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="member, idx : ${memberRankings}">
                    <td>
                        <span th:if="${idx.index == 0}" class="rank-medal">ü•á</span>
                        <span th:if="${idx.index == 1}" class="rank-medal">ü•à</span>
                        <span th:if="${idx.index == 2}" class="rank-medal">ü•â</span>
                        <span th:if="${idx.index > 2}" th:text="${idx.index + 1}"></span>
                    </td>
                    <td>
                        <span class="table-tier-badge" th:style="'background-color:' + ${member.multiTierColor} + '; color: #000;'" th:text="${member.multiTierDisplayName}">Î∏åÎ°†Ï¶à</span>
                    </td>
                    <td th:text="${member.nickname}">ÎãâÎÑ§ÏûÑ</td>
                    <td th:text="${member.multiLp} + ' LP'">0 LP</td>
                    <td th:text="${member.multiWins}">0</td>
                    <td th:text="${member.multiTop3}">0</td>
                    <td th:text="${member.multiGames}">0</td>
                </tr>
                <tr th:if="${#lists.isEmpty(memberRankings)}">
                    <td colspan="7" style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
                        Îû≠ÌÇπ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </main>
</div>
<script th:src="@{/js/common/common.js}"></script>
</body>
</html>
