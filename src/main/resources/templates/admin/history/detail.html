<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common/fragments/head :: adminHead('게임 상세')}"></head>
<body class="admin-page">
<div class="admin-container">
    <th:block th:replace="~{admin/layout/sidebar :: sidebar}"></th:block>

    <main class="main-content">
        <header class="content-header">
            <div class="header-left">
                <a href="/admin/history" class="btn btn-secondary">← 목록</a>
                <h1>게임 상세</h1>
            </div>
        </header>

        <div class="detail-container">
            <div class="detail-section">
                <h3>기본 정보</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <label>별명</label>
                        <span th:text="${gameSession.nickname}"></span>
                    </div>
                    <div class="info-item">
                        <label>게임유형</label>
                        <span class="type-badge" th:classappend="${gameSession.gameType.name()}"
                              th:switch="${gameSession.gameType.name()}">
                            <span th:case="'SOLO_HOST'">게임진행용</span>
                            <span th:case="'SOLO_GUESS'">내가맞추기</span>
                            <span th:case="'FAN_CHALLENGE'">아티스트 챌린지</span>
                            <span th:case="'GENRE_CHALLENGE'">장르 챌린지</span>
                            <span th:case="'RETRO_GUESS'">레트로 게임</span>
                            <span th:case="*">기타</span>
                        </span>
                    </div>
                    <div class="info-item">
                        <label>게임모드</label>
                        <span th:switch="${gameSession.gameMode.name()}">
                            <span th:case="'RANDOM'">전체 랜덤</span>
                            <span th:case="'RETRO'">레트로</span>
                            <span th:case="'GENRE_PER_ROUND'">라운드별 장르 선택</span>
                            <span th:case="'FIXED_GENRE'">고정 장르</span>
                            <span th:case="'FIXED_ARTIST'">고정 아티스트</span>
                            <span th:case="'FIXED_YEAR'">고정 연도</span>
                            <span th:case="'ARTIST_PER_ROUND'">라운드별 아티스트 선택</span>
                            <span th:case="'YEAR_PER_ROUND'">라운드별 연도 선택</span>
                            <span th:case="*" th:text="${gameSession.gameMode.name()}">기타</span>
                        </span>
                    </div>
                    <!-- 고정 장르 표시 -->
                    <div class="info-item" th:if="${gameSession.gameMode.name() == 'FIXED_GENRE' and fixedGenreName != null}">
                        <label>선택 장르</label>
                        <span class="highlight-value" th:text="${fixedGenreName}"></span>
                    </div>
                    <!-- 고정 연도 표시 -->
                    <div class="info-item" th:if="${gameSession.gameMode.name() == 'FIXED_YEAR' and settings.selectedYears != null and !settings.selectedYears.isEmpty()}">
                        <label>선택 연도</label>
                        <span class="highlight-value" th:text="${#strings.listJoin(settings.selectedYears, ', ')} + '년'"></span>
                    </div>
                    <!-- 고정 아티스트 표시 -->
                    <div class="info-item" th:if="${gameSession.gameMode.name() == 'FIXED_ARTIST' and settings.selectedArtists != null and !settings.selectedArtists.isEmpty()}">
                        <label>선택 아티스트</label>
                        <span class="highlight-value" th:text="${#strings.listJoin(settings.selectedArtists, ', ')}"></span>
                    </div>
                    <div class="info-item">
                        <label>솔로/그룹</label>
                        <span th:if="${settings.soloOnly}">솔로만</span>
                        <span th:if="${settings.groupOnly}">그룹만</span>
                        <span th:if="${!settings.soloOnly and !settings.groupOnly}">전체</span>
                    </div>
                    <div class="info-item">
                        <label>상태</label>
                        <span class="game-status" th:classappend="${gameSession.status.name()}"
                              th:switch="${gameSession.status.name()}">
                                <span th:case="'PLAYING'">진행중</span>
                                <span th:case="'COMPLETED'">완료</span>
                                <span th:case="'ABANDONED'">중도포기</span>
                            </span>
                    </div>
                    <div class="info-item">
                        <label>시작시간</label>
                        <span th:text="${#temporals.format(gameSession.startedAt, 'yyyy-MM-dd HH:mm:ss')}"></span>
                    </div>
                    <div class="info-item">
                        <label>종료시간</label>
                        <span th:text="${gameSession.endedAt != null} ? ${#temporals.format(gameSession.endedAt, 'yyyy-MM-dd HH:mm:ss')} : '-'"></span>
                    </div>
                    <div class="info-item">
                        <label>플레이 시간</label>
                        <span th:text="${gameSession.playTimeSeconds} + '초'"></span>
                    </div>
                    <div class="info-item">
                        <label>세션 UUID</label>
                        <span class="uuid" th:text="${gameSession.sessionUuid} ?: '-'"></span>
                    </div>
                </div>
            </div>

            <div class="detail-section">
                <h3>게임 결과</h3>
                <div class="result-cards">
                    <div class="result-card">
                        <div class="result-value" th:text="${gameSession.totalScore}">0</div>
                        <div class="result-label">총점</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value">
                            <span th:text="${gameSession.completedRounds}">0</span>/<span th:text="${gameSession.totalRounds}">0</span>
                        </div>
                        <div class="result-label">완료 라운드</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value">
                            <span th:text="${gameSession.correctCount}">0</span>/<span th:text="${gameSession.completedRounds}">0</span>
                        </div>
                        <div class="result-label">정답</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" th:text="${#numbers.formatDecimal(gameSession.accuracyRate, 0, 1)} + '%'">0%</div>
                        <div class="result-label">정답률</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" th:text="${gameSession.skipCount} ?: 0">0</div>
                        <div class="result-label">스킵</div>
                    </div>
                </div>
            </div>

            <div class="detail-section">
                <h3>라운드 상세</h3>
                <div class="table-container">
                    <table class="data-table round-table">
                        <thead>
                        <tr>
                            <th>R</th>
                            <th>노래</th>
                            <th>아티스트</th>
                            <th>장르</th>
                            <th>사용자 답변</th>
                            <th>정답</th>
                            <th>응답시간</th>
                            <th>점수</th>
                            <th>상태</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="round : ${rounds}" th:classappend="${round.isCorrect} ? 'correct-row' : ''">
                            <td th:text="${round.roundNumber}"></td>
                            <td th:text="${round.song != null} ? ${round.song.title} : '-'"></td>
                            <td th:text="${round.song != null} ? ${round.song.artist} : '-'"></td>
                            <td th:text="${round.genre != null} ? ${round.genre.name} : '-'"></td>
                            <td th:text="${round.userAnswer} ?: '-'"></td>
                            <td>
                                        <span th:if="${round.isCorrect != null}"
                                              th:class="${round.isCorrect} ? 'correct-badge' : 'wrong-badge'"
                                              th:text="${round.isCorrect} ? 'O' : 'X'"></span>
                                <span th:if="${round.isCorrect == null}">-</span>
                            </td>
                            <td th:text="${round.answerTimeFormatted}"></td>
                            <td th:text="${round.score}"></td>
                            <td>
                                        <span class="round-status" th:classappend="${round.status.name()}"
                                              th:switch="${round.status.name()}">
                                            <span th:case="'WAITING'">대기</span>
                                            <span th:case="'PLAYING'">재생중</span>
                                            <span th:case="'ANSWERED'">답변</span>
                                            <span th:case="'SKIPPED'">스킵</span>
                                            <span th:case="'TIMEOUT'">시간초과</span>
                                        </span>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(rounds)}">
                            <td colspan="9" class="empty-row">라운드 정보가 없습니다.</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>
</div>

<script th:src="@{/js/common/common.js}"></script>
</body>
</html>