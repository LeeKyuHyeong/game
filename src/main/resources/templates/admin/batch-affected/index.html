<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common/fragments/head :: adminHead('배치 영향 곡 관리')}"></head>
<body class="admin-page">
<link rel="stylesheet" th:href="@{/css/admin/table-mobile-collapse.css}">
<link rel="stylesheet" th:href="@{/css/admin/batch-affected.css}">
<div class="admin-container">
    <th:block th:replace="~{admin/layout/sidebar :: sidebar}"></th:block>

    <main class="main-content">
        <header class="content-header">
            <div class="header-content">
                <div>
                    <h1>배치 영향 곡 관리</h1>
                    <p>배치에 의해 비활성화된 곡 목록을 확인하고 복구할 수 있습니다.</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="refreshContent()">새로고침</button>
                </div>
            </div>
        </header>

        <!-- 통계 카드 -->
        <div class="stats-cards">
            <div class="stat-card">
                <div class="stat-value" th:text="${stats.total}">0</div>
                <div class="stat-label">전체</div>
            </div>
            <div class="stat-card unrestored">
                <div class="stat-value" th:text="${stats.unrestored}">0</div>
                <div class="stat-label">미복구</div>
            </div>
            <div class="stat-card restored">
                <div class="stat-value" th:text="${stats.restored}">0</div>
                <div class="stat-label">복구됨</div>
            </div>
            <div class="stat-card youtube">
                <div class="stat-value" th:text="${stats.youtubeUnrestored}">0</div>
                <div class="stat-label">YouTube (미복구)</div>
            </div>
            <div class="stat-card duplicate">
                <div class="stat-value" th:text="${stats.duplicateUnrestored}">0</div>
                <div class="stat-label">중복 (미복구)</div>
            </div>
        </div>

        <!-- 필터 섹션 -->
        <div class="filter-section">
            <div class="filter-row">
                <div class="filter-group">
                    <label>배치 유형</label>
                    <select id="filterBatchId" onchange="applyFilters()">
                        <option value="">전체</option>
                        <option value="BATCH_YOUTUBE_VIDEO_CHECK">YouTube 검증</option>
                        <option value="BATCH_DUPLICATE_SONG_CHECK">중복 검사</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>복구 상태</label>
                    <select id="filterRestored" onchange="applyFilters()">
                        <option value="">전체</option>
                        <option value="false">미복구</option>
                        <option value="true">복구됨</option>
                    </select>
                </div>
                <div class="filter-group search-group">
                    <label>검색</label>
                    <div class="search-input-wrapper">
                        <input type="text" id="filterKeyword" placeholder="아티스트, 제목..."
                               onkeypress="if(event.key==='Enter') applyFilters()">
                        <button class="btn btn-sm btn-primary" onclick="applyFilters()">검색</button>
                    </div>
                </div>
            </div>
            <div class="filter-actions">
                <button class="btn btn-sm btn-secondary" onclick="clearFilters()">필터 초기화</button>
                <button class="btn btn-sm btn-warning" onclick="restoreSelected()">선택 복구</button>
                <button class="btn btn-sm btn-info" onclick="restoreAllByBatch('BATCH_YOUTUBE_VIDEO_CHECK')">YouTube 전체 복구</button>
                <button class="btn btn-sm btn-info" onclick="restoreAllByBatch('BATCH_DUPLICATE_SONG_CHECK')">중복 전체 복구</button>
            </div>
        </div>

        <!-- 목록 콘텐츠 (AJAX 로딩) -->
        <div class="content-wrapper" id="contentWrapper">
            <div class="loading-spinner">
                <div class="spinner"></div>
                <span>로딩 중...</span>
            </div>
        </div>
    </main>
</div>

<!-- 곡 상세 모달 -->
<div id="songDetailModal" class="modal">
    <div class="modal-content modal-md">
        <div class="modal-header">
            <h2 id="songDetailTitle">곡 상세</h2>
            <button class="close-btn" onclick="closeModal('songDetailModal')">&times;</button>
        </div>
        <div class="modal-body" id="songDetailContent">
            <!-- 동적으로 채워짐 -->
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-cancel" onclick="closeModal('songDetailModal')">닫기</button>
        </div>
    </div>
</div>

<script th:src="@{/js/common/common.js}"></script>
<script th:src="@{/js/admin/admin-batch-affected.js}"></script>
</body>
</html>
