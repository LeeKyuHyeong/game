<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common/fragments/head :: adminHead('ì˜¤ë‹µ í†µê³„')}"></head>
<link rel="stylesheet" th:href="@{/css/admin/stats.css}">
<body class="admin-page">
<div class="admin-container">
    <th:block th:replace="~{admin/layout/sidebar :: sidebar}"></th:block>
    <main class="main-content">
        <header class="content-header">
            <h1>âŒ ì˜¤ë‹µ í†µê³„</h1>
            <p>ì‚¬ìš©ìë“¤ì´ ìì£¼ í‹€ë¦¬ëŠ” ë‹µë³€ê³¼ ì–´ë ¤ìš´ ê³¡ì„ ë¶„ì„í•©ë‹ˆë‹¤.</p>
        </header>

        <!-- ìš”ì•½ ì¹´ë“œ -->
        <div class="stats-cards">
            <div class="stat-card">
                <div class="stat-icon">ğŸ“</div>
                <div class="stat-info">
                    <span class="stat-value" th:text="${summary.totalWrongCount}">0</span>
                    <span class="stat-label">ì´ ì˜¤ë‹µ ìˆ˜</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ”¤</div>
                <div class="stat-info">
                    <span class="stat-value" th:text="${summary.uniqueWrongAnswers}">0</span>
                    <span class="stat-label">ê³ ìœ  ì˜¤ë‹µ ì¢…ë¥˜</span>
                </div>
            </div>
        </div>

        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="stats-tabs">
            <button class="stats-tab active" data-tab="common">ìì£¼ í‹€ë¦¬ëŠ” ë‹µë³€</button>
            <button class="stats-tab" data-tab="hardest">ì–´ë ¤ìš´ ê³¡ TOP</button>
            <button class="stats-tab" data-tab="recent">ìµœê·¼ ì˜¤ë‹µ</button>
        </div>

        <!-- ìì£¼ í‹€ë¦¬ëŠ” ë‹µë³€ -->
        <div class="stats-panel" id="commonPanel">
            <div class="panel-header">
                <h3>ğŸ”¥ ìì£¼ í‹€ë¦¬ëŠ” ë‹µë³€ TOP 20</h3>
                <span class="panel-desc">ì˜¤ë‹µê³¼ ì •ë‹µ ê³¡ ìŒìœ¼ë¡œ ê·¸ë£¹í•‘</span>
            </div>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th style="width:50px;">ìˆœìœ„</th>
                        <th style="width:200px;">ì˜¤ë‹µ</th>
                        <th>ì •ë‹µ ê³¡</th>
                        <th style="width:80px;">íšŸìˆ˜</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="item, idx : ${commonWrongAnswers}">
                        <td data-label="ìˆœìœ„">
                            <span class="rank-badge" th:classappend="${idx.index < 3} ? 'top-' + (idx.index + 1) : ''">
                                <span th:text="${idx.index + 1}">1</span>
                            </span>
                        </td>
                        <td data-label="ì˜¤ë‹µ">
                            <span class="wrong-text" th:text="${item.answer}">ì˜¤ë‹µ</span>
                        </td>
                        <td data-label="ì •ë‹µ ê³¡">
                            <div class="song-info">
                                <span class="song-title" th:text="${item.songTitle}">ì œëª©</span>
                                <span class="song-artist" th:text="${item.artist}">ì•„í‹°ìŠ¤íŠ¸</span>
                            </div>
                        </td>
                        <td data-label="íšŸìˆ˜" th:text="${item.count} + 'íšŒ'">0íšŒ</td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(commonWrongAnswers)}" class="empty-row">
                        <td colspan="4" class="empty-state">
                            ì•„ì§ ì˜¤ë‹µ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- ì–´ë ¤ìš´ ê³¡ TOP -->
        <div class="stats-panel" id="hardestPanel" style="display:none;">
            <div class="panel-header">
                <h3>ğŸ’€ ê°€ì¥ ì–´ë ¤ìš´ ê³¡ TOP 20</h3>
                <span class="panel-desc">ìµœì†Œ 5íšŒ ì´ìƒ í”Œë ˆì´ëœ ê³¡ ê¸°ì¤€</span>
            </div>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th style="width:50px;">ìˆœìœ„</th>
                        <th>ê³¡ ì •ë³´</th>
                        <th style="width:100px;">ì •ë‹µë¥ </th>
                        <th style="width:100px;">í”Œë ˆì´</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="song, idx : ${hardestSongs}">
                        <td data-label="ìˆœìœ„">
                            <span class="rank-badge" th:classappend="${idx.index < 3} ? 'top-' + (idx.index + 1) : ''">
                                <span th:text="${idx.index + 1}">1</span>
                            </span>
                        </td>
                        <td data-label="ê³¡ ì •ë³´">
                            <div class="song-info">
                                <span class="song-title" th:text="${song.title}">ì œëª©</span>
                                <span class="song-artist" th:text="${song.artist}">ì•„í‹°ìŠ¤íŠ¸</span>
                            </div>
                        </td>
                        <td data-label="ì •ë‹µë¥ ">
                            <div class="rate-bar">
                                <div class="rate-fill" th:style="'width:' + ${song.correctRate} + '%'"></div>
                                <span class="rate-text" th:text="${song.correctRate} + '%'">0%</span>
                            </div>
                        </td>
                        <td data-label="í”Œë ˆì´" th:text="${song.totalPlays} + 'íšŒ'">0íšŒ</td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(hardestSongs)}" class="empty-row">
                        <td colspan="4" class="empty-state">
                            ì•„ì§ ì¶©ë¶„í•œ í”Œë ˆì´ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- ìµœê·¼ ì˜¤ë‹µ -->
        <div class="stats-panel" id="recentPanel" style="display:none;">
            <div class="panel-header">
                <h3>ğŸ• ìµœê·¼ ì˜¤ë‹µ ë‚´ì—­</h3>
            </div>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th style="width:200px;">ì˜¤ë‹µ</th>
                        <th>ì •ë‹µ ê³¡</th>
                        <th style="width:150px;">ì‹œê°„</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="item : ${recentWrongAnswers}">
                        <td data-label="ì˜¤ë‹µ">
                            <span class="wrong-text" th:text="${item.userAnswer}">ì˜¤ë‹µ</span>
                        </td>
                        <td data-label="ì •ë‹µ ê³¡">
                            <div class="song-info">
                                <span class="song-title" th:text="${item.songTitle}">ì œëª©</span>
                                <span class="song-artist" th:text="${item.artist}">ì•„í‹°ìŠ¤íŠ¸</span>
                            </div>
                        </td>
                        <td data-label="ì‹œê°„" th:text="${#temporals.format(item.createdAt, 'MM.dd HH:mm')}">01.01 00:00</td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(recentWrongAnswers)}" class="empty-row">
                        <td colspan="3" class="empty-state">
                            ì•„ì§ ì˜¤ë‹µ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>
</div>
<script th:src="@{/js/common/common.js}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // íƒ­ ì „í™˜
        document.querySelectorAll('.stats-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.stats-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');

                const tabName = this.dataset.tab;
                document.querySelectorAll('.stats-panel').forEach(panel => {
                    panel.style.display = 'none';
                });
                document.getElementById(tabName + 'Panel').style.display = 'block';
            });
        });
    });
</script>
<style>
    .stats-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
    }
    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        padding: 20px;
        display: flex;
        align-items: center;
        gap: 16px;
        color: white;
    }
    .stat-icon {
        font-size: 2rem;
    }
    .stat-value {
        font-size: 1.8rem;
        font-weight: 700;
        display: block;
    }
    .stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
    }
    .stats-tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }
    .stats-tab {
        padding: 10px 20px;
        background: #2d3748;
        border: 1px solid #4a5568;
        border-radius: 8px;
        color: #a0aec0;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.2s;
    }
    .stats-tab:hover {
        background: #4a5568;
        color: #fff;
    }
    .stats-tab.active {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: #fff;
        border-color: transparent;
    }
    .stats-panel {
        background: #1a1a2e;
        border-radius: 12px;
        padding: 20px;
    }
    .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
    }
    .panel-header h3 {
        color: #fff;
        font-size: 1.1rem;
        margin: 0;
    }
    .panel-desc {
        font-size: 0.8rem;
        color: rgba(255,255,255,0.5);
    }
    .wrong-answer-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    .wrong-answer-item {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 12px 16px;
        background: rgba(255,255,255,0.05);
        border-radius: 8px;
    }
    .wrong-answer-item .rank {
        width: 30px;
        height: 30px;
        background: #667eea;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 0.9rem;
        color: #fff;
    }
    .wrong-answer-item .answer {
        flex: 1;
        color: #e2e8f0;
        font-size: 0.95rem;
    }
    .wrong-answer-item .count {
        color: #a0aec0;
        font-size: 0.85rem;
    }
    .stats-table {
        width: 100%;
        border-collapse: collapse;
    }
    .stats-table th {
        background: #2d3748;
        padding: 12px 16px;
        text-align: left;
        color: #a0aec0;
        font-size: 0.85rem;
        font-weight: 600;
    }
    .stats-table td {
        padding: 12px 16px;
        border-bottom: 1px solid #2d3748;
        color: #e2e8f0;
        font-size: 0.9rem;
    }
    .stats-table tr:hover td {
        background: rgba(255,255,255,0.05);
    }
    .rank-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        background: #4a5568;
        border-radius: 50%;
        font-weight: 600;
        font-size: 0.85rem;
    }
    .rank-badge.top-1 { background: linear-gradient(135deg, #ffd700, #ffb347); color: #1a1a2e; }
    .rank-badge.top-2 { background: linear-gradient(135deg, #c0c0c0, #a8a8a8); color: #1a1a2e; }
    .rank-badge.top-3 { background: linear-gradient(135deg, #cd7f32, #b87333); color: #fff; }
    .song-info {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }
    .song-title {
        font-weight: 500;
    }
    .song-artist {
        font-size: 0.8rem;
        color: #a0aec0;
    }
    .rate-bar {
        position: relative;
        width: 100%;
        height: 20px;
        background: rgba(255,255,255,0.1);
        border-radius: 10px;
        overflow: hidden;
    }
    .rate-fill {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        background: linear-gradient(90deg, #ff4757, #ff6b81);
        border-radius: 10px;
        transition: width 0.3s;
    }
    .rate-text {
        position: relative;
        z-index: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        font-size: 0.75rem;
        font-weight: 600;
        color: #fff;
    }
    .wrong-text {
        color: #ff4757;
        font-weight: 500;
    }
    .empty-state {
        text-align: center;
        padding: 40px;
        color: rgba(255,255,255,0.5);
    }
    @media (max-width: 768px) {
        .stats-cards {
            grid-template-columns: 1fr;
        }
        .stats-tabs {
            overflow-x: auto;
            flex-wrap: nowrap;
            padding-bottom: 8px;
        }
        .stats-tab {
            flex-shrink: 0;
            padding: 8px 16px;
            font-size: 0.85rem;
        }
        .stats-panel {
            padding: 12px;
        }
        .panel-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 4px;
        }
        .panel-header h3 {
            font-size: 1rem;
        }

        /* í…Œì´ë¸”ì„ ì¹´ë“œ ë·°ë¡œ ë³€í™˜ */
        .stats-table {
            border-collapse: separate;
            border-spacing: 0;
        }
        .stats-table thead {
            display: none;
        }
        .stats-table tbody {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .stats-table tbody tr {
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .stats-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        /* ì…€ ìŠ¤íƒ€ì¼ */
        .stats-table td {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .stats-table td:last-child {
            border-bottom: none;
        }

        /* ë¼ë²¨ í‘œì‹œ */
        .stats-table td::before {
            content: attr(data-label);
            font-weight: 600;
            color: #a0aec0;
            font-size: 0.75rem;
            text-transform: uppercase;
            flex-shrink: 0;
            margin-right: 12px;
        }

        /* ìˆœìœ„ ì…€ - ì¹´ë“œ ìƒë‹¨ì— ê°•ì¡° í‘œì‹œ */
        .stats-table td[data-label="ìˆœìœ„"] {
            order: -1;
            justify-content: flex-start;
            padding-bottom: 12px;
            margin-bottom: 4px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .stats-table td[data-label="ìˆœìœ„"]::before {
            display: none;
        }
        .stats-table td[data-label="ìˆœìœ„"] .rank-badge {
            width: 32px;
            height: 32px;
            font-size: 1rem;
        }

        /* ì˜¤ë‹µ ì…€ ê°•ì¡° */
        .stats-table td[data-label="ì˜¤ë‹µ"] {
            order: -1;
            padding-top: 0;
        }
        .stats-table td[data-label="ì˜¤ë‹µ"] .wrong-text {
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* ê³¡ ì •ë³´ */
        .stats-table td .song-info {
            text-align: right;
        }
        .stats-table td .song-title {
            font-size: 0.9rem;
        }
        .stats-table td .song-artist {
            font-size: 0.75rem;
        }

        /* ì •ë‹µë¥  ë°” */
        .stats-table td .rate-bar {
            width: 100px;
            height: 18px;
        }
        .stats-table td .rate-text {
            font-size: 0.7rem;
        }

        /* ë¹ˆ ìƒíƒœ */
        .stats-table tbody tr.empty-row {
            padding: 30px;
        }
        .stats-table tbody tr.empty-row td {
            justify-content: center;
        }
        .stats-table tbody tr.empty-row td::before {
            display: none;
        }
    }
</style>
</body>
</html>
