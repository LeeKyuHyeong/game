<!-- 대중성 투표 탭 콘텐츠 (AJAX 로딩용) -->
<div class="tab-panel popularity-panel" xmlns:th="http://www.thymeleaf.org">
    <link rel="stylesheet" th:href="@{/css/admin/table-mobile-collapse.css}">

    <!-- 서브탭 네비게이션 -->
    <div class="sub-tab-navigation">
        <button class="sub-tab-btn" th:classappend="${activeSubTab == 'songs'} ? 'active'"
                data-subtab="songs" onclick="loadPopularitySubTab('songs')">
            곡별 통계
        </button>
        <button class="sub-tab-btn" th:classappend="${activeSubTab == 'artists'} ? 'active'"
                data-subtab="artists" onclick="loadPopularitySubTab('artists')">
            아티스트별 통계
        </button>
        <button class="sub-tab-btn" th:classappend="${activeSubTab == 'votes'} ? 'active'"
                data-subtab="votes" onclick="loadPopularitySubTab('votes')">
            투표 내역
        </button>
    </div>

    <!-- 서브탭 콘텐츠 -->
    <div class="sub-tab-content" id="popularitySubTabContent">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <span>로딩 중...</span>
        </div>
    </div>

    <script th:inline="javascript">
    var popularityActiveSubTab = /*[[${activeSubTab}]]*/ 'songs';

    function loadPopularitySubTab(subTab) {
        popularityActiveSubTab = subTab;
        document.querySelectorAll('.sub-tab-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelector('[data-subtab="' + subTab + '"]').classList.add('active');

        const container = document.getElementById('popularitySubTabContent');
        container.innerHTML = '<div class="loading-spinner"><div class="spinner"></div><span>로딩 중...</span></div>';

        let url = '/admin/song-popularity/' + subTab + '/content';

        fetch(url)
            .then(response => response.text())
            .then(html => {
                container.innerHTML = html;
            })
            .catch(error => {
                container.innerHTML = '<div class="error-message">콘텐츠를 불러오는데 실패했습니다.</div>';
                console.error('Error loading sub tab:', error);
            });
    }

    // 초기 로드 - AJAX 동적 로드이므로 바로 실행
    loadPopularitySubTab(popularityActiveSubTab);
    </script>
</div>
