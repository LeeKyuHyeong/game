<!-- 노래 목록 탭 콘텐츠 (프래그먼트) -->
<div class="song-tab-content" xmlns:th="http://www.thymeleaf.org">
    <link rel="stylesheet" th:href="@{/css/admin/table-mobile-collapse.css}">
    <link rel="stylesheet" th:href="@{/css/admin/song-grid.css}">

    <!-- Filter Section -->
    <div class="filter-section">
        <form id="filterForm">
            <input type="hidden" name="page" id="pageInput" th:value="${currentPage}">
            <input type="hidden" name="sort" th:value="${sort}">
            <input type="hidden" name="direction" th:value="${direction}">
            <input type="hidden" name="viewMode" th:value="${viewMode}">

            <!-- Search & Select Filters Row -->
            <div class="filter-row filter-selects">
                <div class="filter-group search-group">
                    <label class="filter-label">검색</label>
                    <input type="text" name="keyword" th:value="${keyword}" placeholder="제목 또는 아티스트 검색">
                </div>

                <!-- Genre Select -->
                <div class="filter-group">
                    <label class="filter-label">장르</label>
                    <select name="genreId" class="filter-select">
                        <option value="">전체</option>
                        <option th:each="genre : ${genres}"
                                th:value="${genre.id}"
                                th:text="${genre.name}"
                                th:selected="${selectedGenreId == genre.id}"></option>
                    </select>
                </div>

                <!-- Use Status Select -->
                <div class="filter-group">
                    <label class="filter-label">사용여부</label>
                    <select name="useYn" class="filter-select">
                        <option value="">전체</option>
                        <option value="Y" th:selected="${selectedUseYn == 'Y'}">사용</option>
                        <option value="N" th:selected="${selectedUseYn == 'N'}">미사용</option>
                    </select>
                </div>

                <!-- Solo/Group Select -->
                <div class="filter-group">
                    <label class="filter-label">솔로/그룹</label>
                    <select name="isSolo" class="filter-select">
                        <option value="">전체</option>
                        <option value="true" th:selected="${selectedIsSolo == true}">솔로</option>
                        <option value="false" th:selected="${selectedIsSolo == false}">그룹</option>
                    </select>
                </div>

                <!-- Release Year Select -->
                <div class="filter-group">
                    <label class="filter-label">연도</label>
                    <select name="releaseYear" class="filter-select">
                        <option value="">전체</option>
                        <option th:each="year : ${years}"
                                th:value="${year}"
                                th:text="${year}"
                                th:selected="${selectedReleaseYear == year}"></option>
                    </select>
                </div>

                <div class="filter-actions">
                    <button type="submit" class="btn btn-search">검색</button>
                    <a href="#" class="btn btn-reset">초기화</a>
                    <button type="button" class="btn btn-primary" onclick="openModal()">+ 노래 추가</button>
                </div>
            </div>

            <!-- Artist Filter Section (2-Section Layout) -->
            <div class="filter-row artist-filter">
                <!-- Selected Artists -->
                <div class="selected-artists-section">
                    <label class="filter-label">선택된 아티스트 (<span id="selectedCount">0</span>)</label>
                    <div id="selectedArtistsTags" class="selected-artists-tags">
                        <span class="no-selection-text">선택된 아티스트가 없습니다</span>
                    </div>
                </div>

                <!-- All Artists List -->
                <div class="all-artists-section">
                    <div class="artist-list-header">
                        <label class="filter-label">전체 아티스트</label>
                        <div class="artist-list-controls">
                            <label class="select-all-checkbox">
                                <input type="checkbox" id="selectAllArtists" onchange="toggleSelectAllArtists()">
                                <span>전체</span>
                            </label>
                            <select id="artistSortOrder" class="artist-sort-select" onchange="sortArtistList()">
                                <option value="count">인기순</option>
                                <option value="name">가나다순</option>
                            </select>
                            <input type="text" id="artistSearchInput" class="artist-search-input"
                                   placeholder="아티스트 검색..." oninput="filterArtistList()">
                        </div>
                    </div>
                    <div id="artistCheckboxGrid" class="artist-checkbox-grid">
                        <label class="artist-checkbox-item" th:each="a : ${artists}"
                               th:data-name="${a.name}" th:data-count="${a.count}">
                            <input type="checkbox" name="artists" th:value="${a.name}"
                                   th:checked="${selectedArtists != null and selectedArtists.contains(a.name)}"
                                   onchange="updateSelectedArtists()">
                            <span class="artist-name" th:text="${a.name}"></span>
                            <span class="artist-count" th:text="'(' + ${a.count} + ')'"></span>
                        </label>
                    </div>
                    <div class="artist-list-footer">
                        <button type="button" id="showMoreBtn" class="btn btn-text" onclick="toggleShowMore()">
                            더보기 ▼
                        </button>
                    </div>
                </div>
            </div>
        </form>

        <!-- View Mode Toggle -->
        <div class="view-toggle">
            <button type="button" class="view-btn" th:classappend="${viewMode == 'table'} ? 'active'" onclick="setViewMode('table')">
                <span class="icon">☰</span> 테이블
            </button>
            <button type="button" class="view-btn" th:classappend="${viewMode == 'grid'} ? 'active'" onclick="setViewMode('grid')">
                <span class="icon">▦</span> 그리드
            </button>
        </div>
    </div>

    <!-- Table View -->
    <div class="table-container" th:if="${viewMode == 'table'}">
        <table class="data-table sortable-table">
            <thead>
            <tr>
                <th class="col-no">No</th>
                <th class="col-id sortable" th:classappend="${sort == 'id'} ? ('sorted-' + ${direction})"
                    onclick="sortBy('id')">ID <span class="sort-icon"></span></th>
                <th class="sortable" th:classappend="${sort == 'title'} ? ('sorted-' + ${direction})"
                    onclick="sortBy('title')">제목 <span class="sort-icon"></span></th>
                <th class="sortable" th:classappend="${sort == 'artist'} ? ('sorted-' + ${direction})"
                    onclick="sortBy('artist')">아티스트 <span class="sort-icon"></span></th>
                <th>장르</th>
                <th class="sortable" th:classappend="${sort == 'releaseYear'} ? ('sorted-' + ${direction})"
                    onclick="sortBy('releaseYear')">연도 <span class="sort-icon"></span></th>
                <th>솔로</th>
                <th>YouTube</th>
                <th>사용여부</th>
                <th class="sortable" th:classappend="${sort == 'createdAt'} ? ('sorted-' + ${direction})"
                    onclick="sortBy('createdAt')">등록일 <span class="sort-icon"></span></th>
                <th>관리</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="song, iterStat : ${songs}" onclick="toggleRowExpand(this)">
                <td data-label="No" th:text="${currentPage * size + iterStat.index + 1}"></td>
                <td data-label="ID" th:text="${song.id}"></td>
                <td data-label="제목" th:text="${song.title}"></td>
                <td data-label="아티스트" th:text="${song.artist}"></td>
                <td data-label="장르" th:text="${song.genre != null} ? ${song.genre.name} : '-'"></td>
                <td data-label="연도" th:text="${song.releaseYear} ?: '-'"></td>
                <td data-label="솔로">
                    <span class="solo-badge" th:classappend="${song.isSolo} ? 'solo' : 'group'"
                          th:text="${song.isSolo} ? '솔로' : '그룹'"></span>
                </td>
                <td data-label="YouTube" onclick="event.stopPropagation()">
                    <div th:if="${song.youtubeVideoId}" class="youtube-cell">
                        <span th:text="${song.youtubeVideoId}" class="youtube-id"></span>
                        <button class="btn btn-sm btn-play"
                                th:data-video-id="${song.youtubeVideoId}"
                                th:data-start-time="${song.startTime}"
                                th:data-duration="${song.playDuration}"
                                th:data-title="${song.title}"
                                th:data-artist="${song.artist}"
                                onclick="openYoutubePreview(this)">▶</button>
                    </div>
                    <span th:unless="${song.youtubeVideoId}" class="file-none">-</span>
                </td>
                <td data-label="사용여부">
                    <span class="status" th:classappend="${song.useYn == 'Y'} ? 'active' : 'inactive'"
                          th:text="${song.useYn == 'Y'} ? '사용' : '미사용'"></span>
                </td>
                <td data-label="등록일" th:text="${#temporals.format(song.createdAt, 'yyyy-MM-dd')}"></td>
                <td class="action-buttons" data-label="" onclick="event.stopPropagation()">
                    <button class="btn btn-sm btn-edit" th:data-id="${song.id}" onclick="editSong(this.dataset.id)">수정</button>
                    <button class="btn btn-sm btn-toggle" th:data-id="${song.id}" onclick="toggleStatus(this.dataset.id)">상태변경</button>
                    <button class="btn btn-sm btn-popular"
                            th:data-id="${song.id}"
                            th:classappend="${song.isPopular != false} ? 'popular' : 'maniac'"
                            onclick="togglePopular(this.dataset.id)"
                            th:text="${song.isPopular != false} ? '대중곡' : '매니악'"></button>
                    <button class="btn btn-sm btn-delete" th:data-id="${song.id}" onclick="deleteSong(this.dataset.id)">삭제</button>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(songs)}">
                <td colspan="11" class="empty-row">등록된 노래가 없습니다.</td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- Grid View -->
    <div class="song-grid" th:if="${viewMode == 'grid'}">
        <div th:each="song, iterStat : ${songs}" class="song-card" th:classappend="${song.useYn == 'N'} ? 'disabled'">
            <div class="song-card-header">
                <span class="song-no" th:text="'#' + ${currentPage * size + iterStat.index + 1}"></span>
                <span class="song-id" th:text="'ID: ' + ${song.id}"></span>
                <span class="status" th:classappend="${song.useYn == 'Y'} ? 'active' : 'inactive'"
                      th:text="${song.useYn == 'Y'} ? '사용' : '미사용'"></span>
            </div>
            <div class="song-card-body">
                <h3 class="song-title" th:text="${song.title}">제목</h3>
                <p class="song-artist" th:text="${song.artist}">아티스트</p>
                <div class="song-meta">
                    <span th:if="${song.genre}" class="meta-badge genre" th:text="${song.genre.name}"></span>
                    <span th:if="${song.releaseYear}" class="meta-badge year" th:text="${song.releaseYear}"></span>
                    <span class="meta-badge" th:classappend="${song.isSolo} ? 'solo' : 'group'"
                          th:text="${song.isSolo} ? '솔로' : '그룹'"></span>
                </div>
            </div>
            <div class="song-card-footer">
                <button th:if="${song.youtubeVideoId}" class="btn btn-sm btn-play"
                        th:data-video-id="${song.youtubeVideoId}"
                        th:data-start-time="${song.startTime}"
                        th:data-duration="${song.playDuration}"
                        th:data-title="${song.title}"
                        th:data-artist="${song.artist}"
                        onclick="openYoutubePreview(this)">▶ 미리듣기</button>
                <div class="card-actions">
                    <button class="btn btn-sm btn-edit" th:data-id="${song.id}" onclick="editSong(this.dataset.id)">수정</button>
                    <button class="btn btn-sm btn-toggle" th:data-id="${song.id}" onclick="toggleStatus(this.dataset.id)">상태</button>
                    <button class="btn btn-sm btn-popular"
                            th:data-id="${song.id}"
                            th:classappend="${song.isPopular != false} ? 'popular' : 'maniac'"
                            onclick="togglePopular(this.dataset.id)"
                            th:text="${song.isPopular != false} ? '대중' : '매니악'"></button>
                    <button class="btn btn-sm btn-delete" th:data-id="${song.id}" onclick="deleteSong(this.dataset.id)">삭제</button>
                </div>
            </div>
        </div>
        <div th:if="${#lists.isEmpty(songs)}" class="empty-grid">
            <p>등록된 노래가 없습니다.</p>
        </div>
    </div>

    <div class="pagination" th:if="${totalPages > 0}">
        <a href="#" th:classappend="${currentPage == 0} ? 'disabled'" class="page-link" onclick="goToPage(0); return false;">«</a>
        <a href="#" th:classappend="${currentPage == 0} ? 'disabled'" class="page-link" th:onclick="'goToPage(' + ${currentPage - 1} + '); return false;'">‹</a>
        <th:block th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
            <a th:if="${i >= currentPage - 2 and i <= currentPage + 2}" href="#" th:text="${i + 1}" th:classappend="${i == currentPage} ? 'active'" class="page-link" th:onclick="'goToPage(' + ${i} + '); return false;'"></a>
        </th:block>
        <a href="#" th:classappend="${currentPage >= totalPages - 1} ? 'disabled'" class="page-link" th:onclick="'goToPage(' + ${currentPage + 1} + '); return false;'">›</a>
        <a href="#" th:classappend="${currentPage >= totalPages - 1} ? 'disabled'" class="page-link" th:onclick="'goToPage(' + ${totalPages - 1} + '); return false;'">»</a>
    </div>

</div>

