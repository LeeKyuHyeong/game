<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common/fragments/head :: adminHead('노래 관리')}"></head>
<body class="admin-page">
<link rel="stylesheet" th:href="@{/css/admin/table-mobile-collapse.css}">
<link rel="stylesheet" th:href="@{/css/admin/song-grid.css}">
<link rel="stylesheet" th:href="@{/css/admin/song-index.css}">
<div class="admin-container">
    <th:block th:replace="~{admin/layout/sidebar :: sidebar}"></th:block>

    <main class="main-content">
        <header class="content-header">
            <h1>노래 관리</h1>
        </header>

        <!-- 탭 네비게이션 -->
        <div class="tab-navigation">
            <button class="tab-btn" th:classappend="${activeTab == 'song'} ? 'active'"
                    onclick="switchTab('song')">
                <span class="tab-icon">🎶</span>
                <span class="tab-text">노래 목록</span>
            </button>
            <button class="tab-btn" th:classappend="${activeTab == 'report'} ? 'active'"
                    onclick="switchTab('report')">
                <span class="tab-icon">🚨</span>
                <span class="tab-text">곡 신고</span>
                <span id="pendingBadge" class="pending-count-badge" style="display: none;"></span>
            </button>
        </div>

        <!-- 탭 콘텐츠 -->
        <div class="tab-content" id="tabContent">
            <div class="loading-spinner">
                <div class="spinner"></div>
                <span>로딩 중...</span>
            </div>
        </div>
    </main>
</div>

<!-- 노래 추가/수정 모달 -->
<div id="songModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">노래 추가</h2>
            <button class="close-btn" onclick="closeModal()">&times;</button>
        </div>
        <form id="songForm" class="modal-form">
            <input type="hidden" id="songId" name="id">

            <div class="form-row">
                <div class="form-group">
                    <label for="title">제목 *</label>
                    <input type="text" id="title" name="title" required>
                </div>
                <div class="form-group">
                    <label for="artist">아티스트 *</label>
                    <input type="text" id="artist" name="artist" required>
                </div>
            </div>

            <div class="form-group">
                <label for="youtubeUrl">YouTube URL</label>
                <input type="text" id="youtubeUrl" name="youtubeUrl"
                       placeholder="https://www.youtube.com/watch?v=... 또는 https://youtu.be/...">
                <div id="currentYoutubeId" class="current-file"></div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="startTime">시작 시간 (초)</label>
                    <input type="number" id="startTime" name="startTime" min="0" value="0">
                </div>
                <div class="form-group">
                    <label for="playDuration">재생 시간 (초)</label>
                    <input type="number" id="playDuration" name="playDuration" min="1" value="10">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="genreId">장르</label>
                    <select id="genreId" name="genreId">
                        <option value="">선택하세요</option>
                        <option th:each="genre : ${genres}"
                                th:value="${genre.id}"
                                th:text="${genre.name}"></option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="releaseYear">발매연도</label>
                    <input type="number" id="releaseYear" name="releaseYear" min="1900" max="2099" placeholder="예: 2024">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>솔로여부</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="isSolo" value="true"> 솔로
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="isSolo" value="false" checked> 그룹
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label>대중곡</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="isPopular" value="true" checked> 대중곡
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="isPopular" value="false"> 매니악
                        </label>
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>사용여부</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="useYn" value="Y" checked> 사용
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="useYn" value="N"> 미사용
                        </label>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeModal()">취소</button>
                <button type="submit" class="btn btn-primary">저장</button>
            </div>
        </form>
    </div>
</div>

<!-- YouTube 미리보기 모달 -->
<div id="youtubePreviewModal" class="modal">
    <div class="modal-content modal-lg">
        <div class="modal-header">
            <h2 id="youtubePreviewTitle">YouTube 미리보기</h2>
            <button class="close-btn" onclick="closeYoutubePreview()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="youtube-preview-info">
                <span id="previewSongInfo"></span>
                <span id="previewTimeInfo" class="time-info"></span>
            </div>
            <div class="youtube-player-container">
                <div id="youtubePlayer"></div>
            </div>
            <div class="youtube-preview-status">
                <span id="previewStatus"></span>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-cancel" onclick="closeYoutubePreview()">닫기</button>
        </div>
    </div>
</div>

<!-- 신고 처리 모달 -->
<div id="processModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>신고 처리</h2>
            <button class="close-btn" onclick="closeProcessModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="report-detail">
                <p><strong>곡:</strong> <span id="modalSongTitle"></span> - <span id="modalSongArtist"></span></p>
                <p><strong>신고 유형:</strong> <span id="modalReportType"></span></p>
                <p><strong>상세 내용:</strong> <span id="modalDescription"></span></p>
            </div>
            <input type="hidden" id="processReportId">
            <div class="form-group">
                <label>처리 상태</label>
                <select id="processStatus">
                    <option value="PENDING">대기</option>
                    <option value="CONFIRMED">확인됨 (문제 있음)</option>
                    <option value="REJECTED">반려 (문제 없음)</option>
                    <option value="RESOLVED">해결됨</option>
                </select>
            </div>
            <div class="form-group">
                <label>관리자 메모</label>
                <textarea id="adminNote" rows="3" placeholder="처리 내용을 입력하세요"></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeProcessModal()">취소</button>
            <button class="btn btn-primary" onclick="processReport()">처리</button>
        </div>
    </div>
</div>

<script th:src="@{/js/common/common.js}"></script>
<script th:src="@{/js/admin/admin-song.js}"></script>
<script th:src="@{/js/admin/admin-report.js}"></script>
<script th:src="@{/js/admin/admin-song-index.js}"></script>
<script th:inline="javascript">
    currentTab = [[${activeTab}]];
</script>
</body>
</html>
