<!-- 챌린지 관리 탭 콘텐츠 (AJAX 로딩용) -->
<!-- CSS는 부모 페이지(game/index.html)에서 로드됨 -->
<div class="tab-panel challenge-panel" xmlns:th="http://www.thymeleaf.org">
    <!-- 통계 카드 -->
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-value" th:text="${fanTotalCount}">0</div>
            <div class="stat-label">팬 챌린지</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" th:text="${genreTotalCount}">0</div>
            <div class="stat-label">장르 챌린지</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" th:text="${fanArtistCount}">0</div>
            <div class="stat-label">활성 아티스트</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" th:text="${genreActiveGenreCount}">0</div>
            <div class="stat-label">활성 장르</div>
        </div>
    </div>

    <!-- 서브탭 네비게이션 -->
    <div class="sub-tab-navigation">
        <button class="sub-tab-btn" th:classappend="${activeSubTab == 'fan'} ? 'active'"
                data-subtab="fan" onclick="loadChallengeSubTab('fan')">
            팬 챌린지
        </button>
        <button class="sub-tab-btn" th:classappend="${activeSubTab == 'genre'} ? 'active'"
                data-subtab="genre" onclick="loadChallengeSubTab('genre')">
            장르 챌린지
        </button>
        <button class="sub-tab-btn" th:classappend="${activeSubTab == 'stages'} ? 'active'"
                data-subtab="stages" onclick="loadChallengeSubTab('stages')">
            단계 설정
        </button>
    </div>

    <!-- 서브탭 콘텐츠 -->
    <div class="sub-tab-content" id="challengeSubTabContent">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <span>로딩 중...</span>
        </div>
    </div>

    <script th:inline="javascript">
    var challengeActiveSubTab = /*[[${activeSubTab}]]*/ 'fan';

    function loadChallengeSubTab(subTab) {
        challengeActiveSubTab = subTab;
        document.querySelectorAll('.sub-tab-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelector('[data-subtab="' + subTab + '"]').classList.add('active');

        const container = document.getElementById('challengeSubTabContent');
        container.innerHTML = '<div class="loading-spinner"><div class="spinner"></div><span>로딩 중...</span></div>';

        let url = '';
        if (subTab === 'fan') {
            url = '/admin/fan-challenge/content';
        } else if (subTab === 'genre') {
            url = '/admin/genre-challenge/content';
        } else if (subTab === 'stages') {
            url = '/admin/fan-challenge/stages/content';
        }

        fetch(url)
            .then(response => response.text())
            .then(html => {
                container.innerHTML = html;
            })
            .catch(error => {
                container.innerHTML = '<div class="error-message">콘텐츠를 불러오는데 실패했습니다.</div>';
                console.error('Error loading sub tab:', error);
            });
    }

    // 초기 로드 - AJAX 동적 로드이므로 바로 실행
    loadChallengeSubTab(challengeActiveSubTab);
    </script>
</div>
