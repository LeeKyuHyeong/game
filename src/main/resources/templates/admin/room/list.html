<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common/fragments/head :: adminHead('Î∞© Í¥ÄÎ¶¨')}"></head>
<body class="admin-page">
<link rel="stylesheet" th:href="@{/css/admin/table-mobile-collapse.css}">
<link rel="stylesheet" th:href="@{/css/admin/mobile-stats.css}">
<div class="admin-container">
    <th:block th:replace="~{admin/layout/sidebar :: sidebar}"></th:block>

    <main class="admin-main">
        <header class="admin-header">
            <div class="header-content">
                <div>
                    <h1>Î∞© Í¥ÄÎ¶¨</h1>
                    <p>Í≤åÏûÑ Î∞© Î™©Î°ùÏùÑ Ï°∞ÌöåÌïòÍ≥† Í¥ÄÎ¶¨Ìï©ÎãàÎã§.</p>
                </div>
            </div>
        </header>

        <div class="admin-content">
            <!-- ÌÜµÍ≥Ñ Ïπ¥Îìú -->
            <div class="stats-cards room-stats">
                <div class="stat-card">
                    <div class="stat-icon">üö™</div>
                    <div class="stat-info">
                        <span class="stat-value" th:text="${totalRooms}">0</span>
                        <span class="stat-label">Ï†ÑÏ≤¥ Î∞©</span>
                    </div>
                </div>
                <div class="stat-card waiting">
                    <div class="stat-icon">‚è≥</div>
                    <div class="stat-info">
                        <span class="stat-value" th:text="${waitingCount}">0</span>
                        <span class="stat-label">ÎåÄÍ∏∞Ï§ë</span>
                    </div>
                </div>
                <div class="stat-card playing">
                    <div class="stat-icon">üéÆ</div>
                    <div class="stat-info">
                        <span class="stat-value" th:text="${playingCount}">0</span>
                        <span class="stat-label">Í≤åÏûÑÏ§ë</span>
                    </div>
                </div>
                <div class="stat-card finished">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-info">
                        <span class="stat-value" th:text="${finishedCount}">0</span>
                        <span class="stat-label">Ï¢ÖÎ£åÎê®</span>
                    </div>
                </div>
            </div>

            <!-- ÌïÑÌÑ∞ ÏÑπÏÖò -->
            <div class="filter-section">
                <form action="/admin/room" method="get" class="filter-row">
                    <div class="filter-group">
                        <label>Í≤ÄÏÉâ</label>
                        <input type="text" name="keyword" th:value="${keyword}" placeholder="Î∞© Ïù¥Î¶Ñ ÎòêÎäî ÏΩîÎìú">
                    </div>
                    <div class="filter-group">
                        <label>ÏÉÅÌÉú</label>
                        <select name="status">
                            <option value="">Ï†ÑÏ≤¥</option>
                            <option value="WAITING" th:selected="${status == 'WAITING'}">ÎåÄÍ∏∞Ï§ë</option>
                            <option value="PLAYING" th:selected="${status == 'PLAYING'}">Í≤åÏûÑÏ§ë</option>
                            <option value="FINISHED" th:selected="${status == 'FINISHED'}">Ï¢ÖÎ£åÎê®</option>
                        </select>
                    </div>
                    <div class="filter-actions">
                        <button type="submit" class="btn btn-search">Í≤ÄÏÉâ</button>
                        <a href="/admin/room" class="btn btn-reset">Ï¥àÍ∏∞Ìôî</a>
                    </div>
                </form>
            </div>

            <!-- ÌÖåÏù¥Î∏î -->
            <div class="table-container">
                <table class="data-table">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Î∞© ÏΩîÎìú</th>
                        <th>Î∞© Ïù¥Î¶Ñ</th>
                        <th>Î∞©Ïû•</th>
                        <th>Ïù∏Ïõê</th>
                        <th>ÎùºÏö¥Îìú</th>
                        <th>ÏÉÅÌÉú</th>
                        <th>ÏÉùÏÑ±Ïùº</th>
                        <th>Í¥ÄÎ¶¨</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="room : ${rooms}" onclick="toggleRowExpand(this)">
                        <td data-label="ID" th:text="${room.id}"></td>
                        <td data-label="Î∞© ÏΩîÎìú"><code th:text="${room.roomCode}"></code></td>
                        <td data-label="Î∞© Ïù¥Î¶Ñ">
                            <span th:text="${room.roomName}"></span>
                            <span th:if="${room.isPrivate}" class="badge badge-private">ÎπÑÍ≥µÍ∞ú</span>
                        </td>
                        <td data-label="Î∞©Ïû•" th:text="${room.host?.nickname ?: '-'}"></td>
                        <td data-label="Ïù∏Ïõê">
                            <span th:text="${room.currentPlayerCount}"></span> /
                            <span th:text="${room.maxPlayers}"></span>
                        </td>
                        <td data-label="ÎùºÏö¥Îìú">
                            <span th:text="${room.currentRound}"></span> /
                            <span th:text="${room.totalRounds}"></span>
                        </td>
                        <td data-label="ÏÉÅÌÉú">
                            <span class="status-badge"
                                  th:classappend="${room.status.name() == 'WAITING'} ? 'warning' : (${room.status.name() == 'PLAYING'} ? 'success' : 'info')"
                                  th:text="${room.status.name() == 'WAITING'} ? 'ÎåÄÍ∏∞Ï§ë' : (${room.status.name() == 'PLAYING'} ? 'Í≤åÏûÑÏ§ë' : 'Ï¢ÖÎ£å')"></span>
                        </td>
                        <td data-label="ÏÉùÏÑ±Ïùº" th:text="${#temporals.format(room.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
                        <td class="action-buttons" data-label="" onclick="event.stopPropagation()">
                            <button class="btn btn-sm btn-info" th:data-id="${room.id}" onclick="viewRoom(this.dataset.id)">ÏÉÅÏÑ∏</button>
                            <button class="btn btn-sm btn-primary" th:data-id="${room.id}" onclick="viewChat(this.dataset.id)">Ï±ÑÌåÖ</button>
                            <button class="btn btn-sm btn-warning" th:if="${room.status.name() != 'FINISHED'}"
                                    th:data-id="${room.id}" onclick="closeRoom(this.dataset.id)">Ï¢ÖÎ£å</button>
                            <button class="btn btn-sm btn-delete" th:data-id="${room.id}" onclick="deleteRoom(this.dataset.id)">ÏÇ≠Ï†ú</button>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(rooms)}">
                        <td colspan="9" class="empty-row">Îì±Î°ùÎêú Î∞©Ïù¥ ÏóÜÏäµÎãàÎã§.</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò -->
            <div class="pagination" th:if="${totalPages > 0}">
                <a th:href="@{/admin/room(page=0, keyword=${keyword}, status=${status})}"
                   th:classappend="${currentPage == 0} ? 'disabled'" class="page-link">¬´</a>
                <a th:href="@{/admin/room(page=${currentPage - 1}, keyword=${keyword}, status=${status})}"
                   th:classappend="${currentPage == 0} ? 'disabled'" class="page-link">‚Äπ</a>

                <th:block th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                    <a th:if="${i >= currentPage - 2 and i <= currentPage + 2}"
                       th:href="@{/admin/room(page=${i}, keyword=${keyword}, status=${status})}"
                       th:text="${i + 1}"
                       th:classappend="${i == currentPage} ? 'active'" class="page-link"></a>
                </th:block>

                <a th:href="@{/admin/room(page=${currentPage + 1}, keyword=${keyword}, status=${status})}"
                   th:classappend="${currentPage >= totalPages - 1} ? 'disabled'" class="page-link">‚Ä∫</a>
                <a th:href="@{/admin/room(page=${totalPages - 1}, keyword=${keyword}, status=${status})}"
                   th:classappend="${currentPage >= totalPages - 1} ? 'disabled'" class="page-link">¬ª</a>
            </div>
        </div>
    </main>
</div>

<!-- Î∞© ÏÉÅÏÑ∏ Î™®Îã¨ -->
<div id="roomDetailModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Î∞© ÏÉÅÏÑ∏ Ï†ïÎ≥¥</h2>
            <button class="close-btn" onclick="closeModal('roomDetailModal')">&times;</button>
        </div>
        <div class="modal-body" id="roomDetailContent">
            <!-- ÎÇ¥Ïö©Ïù¥ ÎèôÏ†ÅÏúºÎ°ú Î°úÎìúÎê® -->
        </div>
    </div>
</div>

<!-- Ï±ÑÌåÖ ÎÇ¥Ïó≠ Î™®Îã¨ -->
<div id="chatModal" class="modal">
    <div class="modal-content modal-lg">
        <div class="modal-header">
            <h2 id="chatModalTitle">Ï±ÑÌåÖ ÎÇ¥Ïó≠</h2>
            <button class="close-btn" onclick="closeModal('chatModal')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="chat-actions">
                <button class="btn btn-danger btn-sm" id="deleteAllChatsBtn">Î™®Îì† Ï±ÑÌåÖ ÏÇ≠Ï†ú</button>
            </div>
            <div class="chat-container" id="chatContent">
                <!-- ÎÇ¥Ïö©Ïù¥ ÎèôÏ†ÅÏúºÎ°ú Î°úÎìúÎê® -->
            </div>
        </div>
    </div>
</div>

<script th:src="@{/js/common/common.js}"></script>
<script th:src="@{/js/admin/admin-room.js}"></script>
<script>
function toggleRowExpand(row) {
    if (window.innerWidth <= 768) {
        row.classList.toggle('expanded');
    }
}
</script>
</body>
</html>