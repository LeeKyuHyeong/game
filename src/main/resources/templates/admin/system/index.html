<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common/fragments/head :: adminHead('시스템 설정')}"></head>
<body class="admin-page">
<link rel="stylesheet" th:href="@{/css/admin/table-mobile-collapse.css}">
<link rel="stylesheet" th:href="@{/css/admin/member-index.css}">
<link rel="stylesheet" th:href="@{/css/admin/batch.css}">
<link rel="stylesheet" th:href="@{/css/admin/mobile-stats.css}">
<div class="admin-container">
    <th:block th:replace="~{admin/layout/sidebar :: sidebar}"></th:block>

    <main class="main-content">
        <header class="content-header">
            <h1>시스템 설정</h1>
        </header>

        <!-- 통합 통계 카드 -->
        <div class="stats-cards">
            <div class="stat-card">
                <div class="stat-value" th:text="${totalBatches}">0</div>
                <div class="stat-label">전체 배치</div>
            </div>
            <div class="stat-card active">
                <div class="stat-value" th:text="${enabledCount}">0</div>
                <div class="stat-label">활성 배치</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" th:text="${totalMenus}">0</div>
                <div class="stat-label">전체 메뉴</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" th:text="${activeMenus}">0</div>
                <div class="stat-label">활성 메뉴</div>
            </div>
        </div>

        <!-- 탭 네비게이션 -->
        <div class="tab-navigation">
            <button class="tab-btn" th:classappend="${activeTab == 'batch'} ? 'active'"
                    data-tab="batch" onclick="switchTab('batch')">
                <span class="tab-icon">⚙️</span>
                <span class="tab-text">배치 관리</span>
            </button>
            <button class="tab-btn" th:classappend="${activeTab == 'menu'} ? 'active'"
                    data-tab="menu" onclick="switchTab('menu')">
                <span class="tab-icon">📋</span>
                <span class="tab-text">메뉴 관리</span>
            </button>
        </div>

        <!-- 탭 콘텐츠 -->
        <div class="tab-content" id="tabContent">
            <div class="loading-spinner">
                <div class="spinner"></div>
                <span>로딩 중...</span>
            </div>
        </div>
    </main>
</div>

<!-- 배치 상세 모달 -->
<div id="batchDetailModal" class="modal">
    <div class="modal-content modal-lg">
        <div class="modal-header">
            <h2 id="batchDetailTitle">배치 상세</h2>
            <button class="close-btn" onclick="closeModal('batchDetailModal')">×</button>
        </div>
        <div class="modal-body" id="batchDetailContent"></div>
        <div class="modal-footer">
            <button class="btn btn-cancel" onclick="closeModal('batchDetailModal')">닫기</button>
        </div>
    </div>
</div>

<!-- 배치 설정 수정 모달 -->
<div id="batchEditModal" class="modal">
    <div class="modal-content modal-sm">
        <div class="modal-header">
            <h2>배치 설정 수정</h2>
            <button class="close-btn" onclick="closeModal('batchEditModal')">×</button>
        </div>
        <form id="batchEditForm" class="modal-form">
            <input type="hidden" id="editBatchId" name="batchId">
            <div class="form-group">
                <label>배치명</label>
                <input type="text" id="editBatchName" disabled>
            </div>
            <div class="form-group">
                <label for="editCronExpression">Cron 표현식 *</label>
                <input type="text" id="editCronExpression" name="cronExpression" required placeholder="예: 0 30 * * * *">
                <small class="form-hint">초 분 시 일 월 요일 형식 (Spring 6자리)</small>
            </div>
            <div class="form-group">
                <label for="editScheduleText">실행 주기 설명</label>
                <input type="text" id="editScheduleText" name="scheduleText" placeholder="예: 매시간 30분">
            </div>
            <div class="cron-presets">
                <label>빠른 설정:</label>
                <div class="preset-buttons">
                    <button type="button" class="btn btn-xs" onclick="setCronPreset('0 0 * * * *', '매시간')">매시간</button>
                    <button type="button" class="btn btn-xs" onclick="setCronPreset('0 0 3 * * *', '매일 03:00')">매일 03시</button>
                    <button type="button" class="btn btn-xs" onclick="setCronPreset('0 0 0 * * *', '매일 00:00')">매일 자정</button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeModal('batchEditModal')">취소</button>
                <button type="submit" class="btn btn-primary">저장</button>
            </div>
        </form>
    </div>
</div>

<!-- 실행 중 모달 -->
<div id="runningModal" class="modal">
    <div class="modal-content modal-sm">
        <div class="modal-header">
            <h2>배치 실행 중</h2>
        </div>
        <div class="modal-body running-modal-body">
            <div class="running-spinner"></div>
            <p id="runningBatchName">배치를 실행하고 있습니다...</p>
            <div id="runningProgress" class="running-progress"></div>
        </div>
    </div>
</div>

<script th:src="@{/js/common/common.js}"></script>
<script th:src="@{/js/common/toggle-row-expand.js}"></script>
<script th:src="@{/js/admin/admin-system-index.js}"></script>
<script th:inline="javascript">
    currentTab = [[${activeTab}]];
</script>
</body>
</html>
